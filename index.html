<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agro-Chem Invest - Investment Platform</title>
    
    <link rel="icon" type="image/png" href="favicon.png">

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <style>
        /* áŠ áŒ á‰ƒáˆ‹á‹­ á‹¨áŒˆáŒ½ ááˆ­áˆ›á‰µ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            background-color: #e9f5e9;
        }
        
        /* á‹¨ Login/Register áŒˆáŒ½ áŒ€áˆ­á‰£ */
        .login-register-page {
            background-image: linear-gradient(135deg, #1e5a2c 0%, #387c38 100%); 
            display: flex; 
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            width: 100%;
            position: fixed; 
            top: 0;
            left: 0;
            z-index: 10;
        }

        .container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        h1 {
            color: #1e5a2c;
            margin-bottom: 5px;
        }

        p {
            color: #555;
            margin-bottom: 20px;
        }

        /* Tab Buttons Style */
        .tab-buttons {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .tab-buttons button {
            padding: 12px 20px;
            border: none;
            background-color: #f0f0f0;
            color: #555;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s, color 0.3s;
            flex-grow: 1;
        }
        
        .tab-buttons button.active {
            background-color: #387c38;
            color: white;
        }

        .form-box {
            display: none; 
        }

        .form-box.active {
            display: block; 
        }

        .input-group {
            text-align: left;
            margin-bottom: 10px; 
        }

        .input-group label {
            display: block;
            margin-bottom: 3px; 
            font-weight: bold;
            font-size: 14px; 
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box; 
            font-size: 15px;
        }
        
        /* áŠ á‹²áˆµ áˆµá‰³á‹­áˆ: áˆˆ Register á‰áˆá áŠ¥áŠ“ Referral Input áŒáŠ• áˆˆáŒáŠ• áŠ¥áŠ•á‹²áˆ†áŠ‘ */
        .input-group-half {
            display: flex;
            gap: 10px; /* á‰  Input áŠ¥áŠ“ Button áˆ˜áŠ«áŠ¨áˆ áŠ­áá‰°á‰µ áˆˆáˆ˜ááŒ áˆ­ */
            align-items: flex-end; /* á‰áˆá‰ áŠ¨á‰³á‰½ áŠ¥áŠ•á‹²áˆ°áˆˆá */
            margin-bottom: 10px;
        }
        .input-group-half .input-group {
            flex-grow: 1;
            margin-bottom: 0; /* á‹µáˆ­á‰¥ margin áŠ¥áŠ•á‹³á‹­áˆ†áŠ• */
        }
        .input-group-half .submit-btn-register {
            width: 150px; /* áˆˆ Register á‰áˆá áˆµá‹á‰µ áˆ˜áˆµáŒ á‰µ */
            padding: 10px 14px;
            font-size: 16px;
            margin-top: 0; /* áŠ¨áˆ‹á‹­ á‹«áˆˆá‹ margin áŠ¥áŠ•á‹²áŒ á‹ */
        }
        /* á‹¨áŒáŠ• áˆˆáŒáŠ• á‰…áŒ¹ á‹áˆµáŒ¥ áŠ«áˆáˆ†áŠ submit-btn áˆ™áˆ‰ áˆµá‹á‰µ áŠ¥áŠ•á‹²á‹­á‹ */
        .form-box .submit-btn:not(.submit-btn-register) {
            width: 100%;
            padding: 14px;
            font-size: 18px;
            margin-top: 18px; 
        }

        .submit-btn {
            background-color: #1e5a2c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
        }
        .submit-btn:active {
            transform: translateY(1px);
        }

        .submit-btn:hover {
            background-color: #387c38;
        }

        .message {
            margin-top: 10px; 
            font-weight: bold;
        }

        .success {
            color: #4CAF50; 
        }

        .error {
            color: #f44336; 
        }

        /* ***** Dashboard Style ***** */
        .dashboard-page {
            display: none; 
            width: 100%;
            max-width: 1000px;
            background-color: #ffffff;
            padding: 20px 40px 80px 40px; 
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15); 
            text-align: center;
            position: relative; 
            box-sizing: border-box; 
        }

        /* [ADMIN-FEATURE] Admin Dashboard Style */
        .admin-dashboard-page {
            display: none;
            width: 100%;
            max-width: 1200px; /* áˆ°á‹ á‹«áˆˆ áŒˆáŒ½ */
            background-color: #f9f9f9;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        .admin-header {
            text-align: left;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #387c38;
        }
        .admin-header h2 {
            color: #f44336;
            margin: 0;
        }
        
        /* NEW ADMIN NAVIGATION TABS */
        .admin-nav-tabs {
            display: flex;
            justify-content: flex-start;
            margin-bottom: 0px;
        }
        .admin-nav-tabs button {
            padding: 10px 15px;
            border: none;
            background-color: #eee;
            color: #555;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s, color 0.3s;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        .admin-nav-tabs button.admin-nav-active {
            background-color: #387c38;
            color: white;
        }
        .admin-page-content {
            display: none;
            animation: fadeIn 0.5s;
            padding: 15px;
            border: 1px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            background-color: #fff;
        }
        .admin-page-content.active {
            display: block;
        }
        
        /* Admin Transaction List Style (within admin-page-content) */
        .admin-transaction-list {
            margin-top: 0px; 
            text-align: left;
        }
        .admin-transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        .admin-transaction-info {
            flex-grow: 1;
            padding-right: 20px;
        }
        .admin-transaction-info p {
            margin: 3px 0;
            font-size: 14px;
        }
        .admin-actions button {
            padding: 8px 15px;
            margin-left: 10px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }
        .admin-actions .approve-btn {
            background-color: #4CAF50;
            color: white;
        }
        .admin-actions .approve-btn:hover {
            background-color: #387c38;
        }
        .admin-actions .reject-btn {
            background-color: #f44336;
            color: white;
        }
        .admin-actions .reject-btn:hover {
            background-color: #d32f2f;
        }
        .admin-logout-btn {
            background-color: #555;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
        }
        .admin-logout-btn:hover {
            background-color: #333;
        }
        
        /* NEW Investment List Style */
        .admin-investment-item {
            padding: 10px;
            margin-bottom: 8px;
            border: 1px solid #e0e0e0;
            border-radius: 5px;
            background-color: #fcfcfc;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .admin-investment-info p {
            margin: 2px 0;
            font-size: 14px;
        }
        .end-investment-btn {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .end-investment-btn:hover {
            background-color: #d32f2f;
        }
        /* NEW: Resume Button Style */
        .resume-investment-btn {
            background-color: #4CAF50; /* Green color */
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        .resume-investment-btn:hover {
            background-color: #387c38;
        }

        .investment-ended {
            color: #4CAF50;
            font-weight: bold;
        }
        
        /* Bottom Navigation Bar Style (á‹¨áˆ›á‹­áŠ•á‰€áˆ³á‰€áˆµ áŠ¥áŠ•á‹²áˆ†áŠ• á‰°á‰€á‹­áˆ¯áˆ) */
        .bottom-navbar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            background-color: #1e5a2c; 
            padding: 10px 0;
            position: fixed; /* á‰€á‹­áˆ¨áŠ“áˆ: absolute -> fixed */
            bottom: 0;
            left: 50%; /* áŒ¨áˆáˆ¨áŠ“áˆ: áˆˆáˆ˜áˆƒáˆ áˆ›áˆáŒ£á‰µ */
            transform: translateX(-50%); /* áŒ¨áˆáˆ¨áŠ“áˆ: áˆˆáˆ˜áˆƒáˆ áˆ›áˆáŒ£á‰µ */
            width: 100%;
            max-width: 1000px; /* áŒ¨áˆáˆ¨áŠ“áˆ: á‹¨ Dashboard áˆµá‹á‰µ áŠ¥áŠ•á‹²á‹­á‹ */
            border-bottom-left-radius: 15px;
            border-bottom-right-radius: 15px;
            box-sizing: border-box;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.2);
            z-index: 20;
        }
        
        .bottom-navbar button {
            background: none;
            border: none;
            color: #c8e6c9;
            font-size: 14px;
            font-weight: 500;
            padding: 8px 10px;
            cursor: pointer;
            transition: color 0.3s, background-color 0.3s;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .bottom-navbar button:hover {
            color: white; 
        }
        
        .bottom-navbar button.nav-active {
            color: #FFEB3B; 
        }
        
        /* Icons (áˆˆáˆ™áŠ¨áˆ« á‹«áˆ…áˆ) */
        .bottom-navbar button::before {
            content: '';
            font-size: 20px;
            margin-bottom: 3px;
            font-family: Arial, sans-serif; 
        }
        #nav-home::before { content: 'ğŸ '; }
        #nav-investment::before { content: 'ğŸ“ˆ'; }
        #nav-customer-service::before { content: 'ğŸ“'; }
        #nav-account::before { content: 'ğŸ‘¤'; }
        #nav-team::before { content: 'ğŸ‘¥'; }
        
        /* ***** á‹¨áŒˆáŒ½ á‹­á‹˜á‰¶á‰½ (Content Sections) ***** */
        .page-content {
            display: none;
            animation: fadeIn 0.5s;
            padding-bottom: 20px; 
            text-align: left;
        }
        
        .page-content.active {
            display: block;
        }
        
        /* [ADMIN-FEATURE] Transaction Status Colors */
        .status-Pending { color: #ff9800; font-weight: bold; }
        .status-Completed { color: #4CAF50; font-weight: bold; }
        .status-Rejected { color: #f44336; font-weight: bold; }
        
        /* á‹¨á‰°á‰€áˆ©á‰µ áˆµá‰³á‹­áˆá‰½ áŠ áˆá‰°áŠáŠ©áˆ */
        .header {
            display: flex;
            justify-content: start; 
            align-items: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }
        /* Home Page Cards and Buttons */
        .stats-grid {
            display: grid;
            /* 3 áŠ«áˆ­á‹¶á‰½áŠ• á‰ áŠ áŠ•á‹µ áˆ¨á‹µá á‹ˆá‹­áˆ á‰µáŠ•áˆ½ áŠ¨áˆ†áŠ á‰ áŠ áŠ•á‹µ áˆ¨á‹µá áˆ‹á‹­ áŠ¥áŠ•á‹²á‹«áˆ³á‹­ á‰°á‰€á‹­áˆ¯áˆ */
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px;
            margin-bottom: 30px;
        }
        .info-card {
            padding: 25px; 
            border-radius: 15px; 
            text-align: left;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
        }
        .balance-card { background-color: #e8f5e9; border: 1px solid #c8e6c9; }
        
        /* *** NEW DAILY PROFIT CARD STYLE *** */
        .daily-profit-card { 
            background-color: #e3f2fd; 
            border: 1px solid #b3e5fc;
        }
        
        .total-invested-card { background-color: #fff3e0; border: 1px solid #ffe0b2; } /* Old .profit-card renamed for clarity */
        
        .info-card h2 { color: #555; font-size: 18px; margin-top: 0; margin-bottom: 5px; }
        .amount-display { font-size: 38px; font-weight: 900; color: #1e5a2c; margin: 0; }
        .profit-amount-display { color: #ff9800; }
        .action-buttons { display: flex; gap: 20px; margin-bottom: 40px; justify-content: center; }
        .action-buttons button { padding: 15px 40px; font-size: 17px; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s, transform 0.1s; font-weight: bold; box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); flex-grow: 1; max-width: 300px; }
        #deposit-btn { background-color: #4CAF50; color: white; }
        #deposit-btn:hover { background-color: #387c38; }
        #withdraw-btn { background-color: #f44336; color: white; }
        #withdraw-btn:hover { background-color: #d32f2f; }
        
        
        /* Deposit/Withdraw Forms (áŠ áˆá‰°áŠáŠ©áˆ) */
        #deposit-form-content, #withdraw-form-content {
            padding: 20px;
            background-color: #f7fcf7;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            max-width: 600px;
            margin: 0 auto;
        }
        
        /* Account Buttons (áŠ áˆá‰°áŠáŠ©áˆ) */
        .account-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-width: 350px;
            margin: 0 auto;
        }
        .account-buttons button {
            padding: 15px 20px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            color: white; 
        }

        #transaction-history-btn { background-color: #FF9800; }
        #transaction-history-btn:hover { background-color: #e68900; }
        #change-password-btn { background-color: #387c38; }
        #change-password-btn:hover { background-color: #1e5a2c; }
        #logout-btn-account { background-color: #f44336; }
        #logout-btn-account:hover { background-color: #d32f2f; }
        
        /* Investment Page Styles */
        .plan-grid {
            display: flex;
            gap: 20px;
            margin-top: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap; 
            justify-content: center;
        }
        .plan-button {
            background-color: #f7fcf7;
            border: 2px solid #387c38;
            border-radius: 15px;
            padding: 20px;
            width: 100%;
            max-width: 200px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s, background-color 0.2s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.08);
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .plan-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
            background-color: #e8f5e9;
        }
        .plan-button h4 {
            color: #1e5a2c;
            font-size: 20px;
            margin-top: 0;
            margin-bottom: 15px;
        }
        .plan-button .plan-details p {
            margin: 5px 0;
            color: #555;
            font-size: 15px;
        }
        .plan-button .daily-rate {
            font-size: 18px;
            font-weight: bold;
            color: #ff9800;
            margin-top: 10px;
        }
    </style>

</head>
<body>

    <div id="login-register-area" class="login-register-page">
        <div class="container">
            <h1>Agro-Chem Invest</h1>
            <p>á‰ áŒá‰¥áˆ­áŠ“ áŠ¬áˆšáŠ«áˆ áŠ¢áŠ•á‰¨áˆµá‰µ á‰ áˆ›á‹µáˆ¨áŒ á‰ á‹¨á‰€áŠ‘ á‰µáˆ­áá‹áŠ• á‹«áŒáŠ™!</p>

            <div class="tab-buttons">
                <button id="login-tab" class="active">Login</button>
                <button id="register-tab">Register</button>
            </div>

            <form id="login-form" class="form-box active">
                <h2>Login</h2>
                <div class="input-group">
                    <label for="login-identifier">áˆµáˆáŠ­ á‰áŒ¥áˆ­ (áˆˆá‰°áŒ á‰ƒáˆš) / Admin ID (áˆˆáŠ á‹µáˆšáŠ•):</label>
                    <input type="text" id="login-identifier" required>
                </div>
                <div class="input-group">
                    <label for="login-password">á‹¨á‹­áˆˆá á‰ƒáˆ / Password:</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="submit-btn">Login</button>
                <p class="message" id="login-message"></p>
                <p style="margin-top: 20px; font-size: 14px;">
                    áˆ˜áˆˆá‹« á‹¨áˆˆá‹á‰µáˆ? 
                    <a href="#" id="go-to-register" style="color: #387c38; font-weight: bold; text-decoration: none;">áŠ¥á‹šáˆ… á‹­áˆ˜á‹áŒˆá‰¡</a>
                </p>
            </form>

            <form id="register-form" class="form-box">
                <h2>Register</h2>
                <div class="input-group">
                    <label for="register-name">áˆ™áˆ‰ áˆµáˆ / Full Name:</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="input-group">
                    <label for="register-phone">áˆµáˆáŠ­ á‰áŒ¥áˆ­ / Phone Number:</label>
                    <input type="tel" id="register-phone" required pattern="[0-9]{10,15}" title="áˆµáˆáŠ­ á‰áŒ¥áˆ­á‹áŠ• á‰ á‰µáŠ­áŠ­áˆ á‹«áˆµáŒˆá‰¡">
                </div>
                <div class="input-group">
                    <label for="register-password">á‹¨á‹­áˆˆá á‰ƒáˆ / Password (á‰¢á‹«áŠ•áˆµ 6 áŠá‹°áˆ):</label>
                    <input type="password" id="register-password" required minlength="6">
                </div>
                <div class="input-group">
                    <label for="register-confirm-password">á‹¨á‹­áˆˆá á‰ƒáˆ áˆ›áˆ¨áŒ‹áŒˆáŒ« / Confirm Password:</label>
                    <input type="password" id="register-confirm-password" required minlength="6">
                </div>
                
                <div class="input-group-half">
                    <div class="input-group">
                        <label for="register-referral">Referral Code (áŠ áˆµáˆáˆ‹áŒŠ áŠ á‹­á‹°áˆˆáˆ):</label>
                        <input type="text" id="register-referral"> 
                    </div>
                    <button type="submit" class="submit-btn submit-btn-register">Register</button>
                </div>
                
                <p class="message" id="register-message"></p>
                <p style="margin-top: 20px; font-size: 14px;">
                    áˆ˜áˆˆá‹« áŠ áˆˆá‹á‰µ? 
                    <a href="#" id="go-to-login" style="color: #387c38; font-weight: bold; text-decoration: none;">Login á‹«á‹µáˆ­áŒ‰</a>
                </p>
            </form>
        </div>
    </div>
    
    <div id="dashboard-area" class="dashboard-page">
        
        
        <div class="header">
            <h2 style="color: #1e5a2c;"><span id="user-name">áŠ¥áŠ•áŠ³áŠ• á‹°áˆ…áŠ“ áˆ˜áŒ¡! áŠ á‰¶/á‹ˆá‹­á‹˜áˆ® á‰£áˆˆáˆ€á‰¥á‰µ</span></h2>
        </div>

        <div id="home-content" class="page-content active">
            
            <div class="main-home-content" id="main-home-content-div">
                <div class="stats-grid">
                    <div class="info-card balance-card">
                        <h2>áŒ á‰…áˆ‹áˆ‹ á‰€áˆª áˆ‚áˆ³á‰¥ / Total Balance</h2>
                        <p class="amount-display">ETB <span id="current-balance">0.00</span></p> 
                        <small style="color: #00796b;">á‹­áˆ… 50 ETB á‹¨áŠ¥áˆ­áˆµá‹ á‹¨áˆ˜áˆ˜á‹áŒˆá‰¢á‹« á‰¦áŠáˆµ áŠá‹á¢</small>
                    </div>
                    
                    <div class="info-card daily-profit-card">
                        <h2>á‹•áˆˆá‰³á‹Š á‰µáˆ­á / Daily Profit</h2>
                        <p class="amount-display profit-amount-display">ETB <span id="daily-profit-display">0.00</span></p>
                        <small style="color: #387c38;">áŠ¨áŠá‰ƒ áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ á‹¨áˆšáŒˆáŠ áŠ¨áá‰°áŠ› á‹•áˆˆá‰³á‹Š á‰µáˆ­á</small>
                    </div>
                    
                    <div class="info-card total-invested-card">
                        <h2>áŒ á‰…áˆ‹áˆ‹ á‹¨áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ áˆ˜áŒ áŠ•</h2>
                        <p class="amount-display profit-amount-display">ETB <span id="total-invested-amount">0.00</span></p>
                        <small style="color: #ff9800;">á‹•áˆˆá‰³á‹Š á‰µáˆ­á á‹¨áˆšáˆ°áˆ‹á‹ áŠ¨áŒˆá‰£á‹ áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ áŠá‹á¢</small>
                    </div>
                </div>
                
                <div class="action-buttons">
                    <button id="deposit-btn">ğŸ’° áŒˆáŠ•á‹˜á‰¥ áˆ›áˆµáŒˆá‰¢á‹« (Deposit)</button>
                    <button id="withdraw-btn">ğŸ’¸ áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (Withdraw)</button>
                </div>

                <div class="about-section">
                    <h3>ğŸŒ± áˆµáˆˆ áŠ áŒáˆ®-áŠ¬áˆšáŠ«áˆ áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ áŠ¥áŠ“ áŠ á‹‹áŒ­áŠá‰±</h3>
                    <p>á‹¨ **áŠ áŒáˆ®-áŠ¬áˆšáŠ«áˆ áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ** á‹˜áˆ­á á‰ á‹˜áˆ˜áŠ“á‹Š áŒá‰¥áˆ­áŠ“ á‹áˆµáŒ¥ á‰ áŒ£áˆ áˆáŒ£áŠ• á‹•á‹µáŒˆá‰µ áŠ¥á‹«áˆ³á‹¨ á‹«áˆˆ á‹ˆáˆ³áŠ áŠ¢áŠ•á‹±áˆµá‰µáˆª áŠá‹á¢ áˆ›á‹³á‰ áˆªá‹«á‹á‰½á£ á€áˆ¨-á‰°á‰£á‹­ áˆ˜á‹µáŠƒáŠ’á‰¶á‰½ áŠ¥áŠ“ á‹¨áŠ¥á‹µáŒˆá‰µ áˆ˜á‰†áŒ£áŒ áˆªá‹« áŠ¬áˆšáŠ«áˆá‰½ á‹¨áˆáˆ­á‰µ á‰¥áŠ­áŠá‰µáŠ• á‰ áˆ˜á‰€áŠáˆµá£ á‹¨áˆ°á‰¥áˆ áŒ¥áˆ«á‰µáŠ• á‰ áˆ›áˆ³á‹°áŒ áŠ¥áŠ“ á‹¨áˆáŒá‰¥ á‹‹áˆµá‰µáŠ“áŠ• á‰ áˆ›áˆ¨áŒ‹áŒˆáŒ¥ á‹¨á‹“áˆˆáˆ›á‰½áŠ•áŠ• á‹¨áˆáŒá‰¥ ááˆ‹áŒá‰µ áˆˆáˆ›áˆ­áŠ«á‰µ á‰áˆá áˆšáŠ“ á‹­áŒ«á‹ˆá‰³áˆ‰á¢</p>

                    <p><strong>áˆˆáˆáŠ• áŠ¢áŠ•á‰¨áˆµá‰µ áˆ›á‹µáˆ¨áŒ áŠ áˆˆá‰¥á‹á‰µ?</strong> á‹¨á‹“áˆˆáˆ áˆ•á‹á‰¥ á‰áŒ¥áˆ­ á‹•á‹µáŒˆá‰µ áŠ¥áŠ“ á‹¨áŠ á‹¨áˆ­ áŠ•á‰¥áˆ¨á‰µ áˆˆá‹áŒ¥ áˆˆáŒá‰¥áˆ­áŠ“ á‹˜áˆ­á á‹¨á‰´áŠ­áŠ–áˆáŒ‚ ááˆ‹áŒá‰µáŠ• áŒ¨áˆáˆ¯áˆá¢ á‰ á‹šáˆ…áˆ áˆáŠ­áŠ•á‹«á‰µ á‹¨áŒá‰¥áˆ­áŠ“ áŠ¬áˆšáŠ«áˆá‰½ ááˆ‹áŒá‰µ á‰ á‹¨á‹“áˆ˜á‰± áŠ¥á‹«á‹°áŒˆ áŠá‹á¢ á‹¨áŠ¥áŠ› áˆ˜á‹µáˆ¨áŠ­ á‰£áˆˆáˆ€á‰¥á‰¶á‰½áŠ• áŠ¨á‹šáˆ… á‹˜áˆ­á áŒ‹áˆ­ á‰ áˆ›áˆµá‰°áˆ³áˆ°áˆ­ áŒˆáŠ•á‹˜á‰¥á‹ á‰ á‰°áŒ¨á‰£áŒ­ áˆ¥áˆ« áˆ‹á‹­ áŠ¥áŠ•á‹²á‹áˆ á‹«á‹°áˆ­áŒ‹áˆá¢</p>
                    
                    <p><strong>á‹¨áŠ¥áŠ› áˆá‹©áŠá‰µ:</strong> áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µá‹ á‰ áŠƒáˆ‹áŠáŠá‰µ á‰ á‰°áˆáˆ‹á‰ á‰µ áˆ˜áŠ•áŒˆá‹µ á‰ á‹˜áˆ­á‰ áˆ‹á‹­ áŠ¥áŠ•á‹²á‹áˆ áŠ¥áŠ“áˆ¨áŒ‹áŒáŒ£áˆˆáŠ•á¢ áŠ¨áˆáˆ‰áˆ á‰ áˆ‹á‹­á£ áˆˆá‰£áˆˆáˆ€á‰¥á‰¶á‰»á‰½áŠ• á‰ á‹¨á‰€áŠ‘ **áŠ¨áá‰°áŠ› áŠ¥áŠ“ á‹¨á‰°áˆ¨áŒ‹áŒ‹ á‰µáˆ­á** áŠ¥áŠ•á‹²á‹«áŒˆáŠ™ á‹¨áˆšá‹«áˆµá‰½áˆ áŠ áˆµá‰°áˆ›áˆ›áŠ á‹¨áˆ˜á‹‹á‹•áˆˆ áŠ•á‹‹á‹­ áˆ˜á‹µáˆ¨áŠ­áŠ• áŠ¥áŠ•áˆáŒ¥áˆ«áˆˆáŠ•á¢ áŒˆáŠ•á‹˜á‰¥á‹ á‹áˆ á‰¥áˆ áŠ á‹­á‰€áˆ˜áŒ¥áˆá¤ á‹­áˆ áˆ«áˆ!</p>
                </div>
            </div>
            
            <div class="deposit-page-content" id="deposit-page-content-div" style="display: none;">
                <button id="back-to-home-from-deposit-btn" style="float: left; background: #f0f0f0; border: 1px solid #ccc; padding: 10px; border-radius: 5px; cursor: pointer; margin-bottom: 15px;">ğŸ”™ á‹ˆá‹° Home á‰°áˆ˜áˆˆáˆµ</button>
                <div style="clear: both;"></div>

                <div id="deposit-form-content">
                    <h3>ğŸ’µ áŒˆáŠ•á‹˜á‰¥ áˆˆáˆ›áˆµáŒˆá‰£á‰µ á‹¨áˆšá‹«áˆµáˆáˆáŒ‰ áˆ˜áˆ¨áŒƒá‹á‰½ (Deposit)</h3>
                    
                    <div class="payment-info">
                        <p>áŒˆáŠ•á‹˜á‰¥á‹áŠ• áŠ¨á‰³á‰½ á‰ á‰°áŒ á‰€áˆ±á‰µ á‹¨áŠ­áá‹« áˆ˜áŠ•áŒˆá‹¶á‰½ áˆ‹á‹­ á‹«áˆµáŒˆá‰¡:</p>
                        <p>ğŸ¦ **CBE áŠ áŠ«á‹áŠ•á‰µ:** <strong>1000413223133</strong> (áˆµáˆ: Mikiyas)</p>
                        <p>ğŸ“± **Telebirr:** <strong>0942945499</strong> (áˆµáˆ: Mikiyas)</p>
                        <p style="margin-top: 10px; color: #ff9800; font-weight: bold;">áŒˆáŠ•á‹˜á‰¥ áŠ«áˆµáŒˆá‰¡ á‰ áŠ‹áˆ‹ **Transaction ID (á‹¨á‹á‹á‹áˆ­ á‰áŒ¥áˆ­)** áˆ˜áˆ˜á‹áŒˆá‰¥á‹áŠ• áŠ á‹­áˆ­áˆ±!</p>
                    </div>

                    <form id="deposit-form">
                        <div class="input-group">
                            <label for="deposit-amount">á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ˜áŒ áŠ• (Amount) - á‰ ETB:</label>
                            <input type="number" id="deposit-amount" min="500" placeholder="á‰¢á‹«áŠ•áˆµ 500 ETB" required>
                        </div>
                        <div class="input-group">
                            <label for="transaction-id">Transaction ID (á‹¨á‹á‹á‹áˆ­ á‰áŒ¥áˆ­):</label>
                            <input type="text" id="transaction-id" placeholder="áˆˆáˆáˆ³áˆŒ: AB12345678" required>
                        </div>
                        
                        <button type="submit" id="deposit-submit-btn" class="submit-btn">âœ… Deposit áŒ¥á‹«á‰„ áŠ áˆµáŒˆá‰£</button>
                        <p class="message deposit-message" id="deposit-form-message"></p>
                    </form>
                </div>
            </div>
            
            <div class="withdraw-page-content" id="withdraw-page-content-div" style="display: none;">
                <button id="back-to-home-from-withdraw-btn" style="float: left; background: #f0f0f0; border: 1px solid #ccc; padding: 10px; border-radius: 5px; cursor: pointer; margin-bottom: 15px;">ğŸ”™ á‹ˆá‹° Home á‰°áˆ˜áˆˆáˆµ</button>
                <div style="clear: both;"></div>

                <div id="withdraw-form-content">
                    <h3>ğŸ’¸ áŒˆáŠ•á‹˜á‰¥ áˆ›á‹áŒ« (Withdraw)</h3>
                    
                    <p style="text-align: center; color: #f44336; font-weight: bold;">á‰¢á‹«áŠ•áˆµ 100 ETB áˆ›á‹áŒ£á‰µ á‹­á‰½áˆ‹áˆ‰ 10% áŒá‰¥áˆ­</p>

                    <form id="withdraw-form">
                        <div class="input-group">
                            <label for="withdraw-bank-name">á‹¨á‰£áŠ•áŠ­ áˆµáˆ:</label>
                            <select id="withdraw-bank-name" required>
                                <option value="">--- á‹¨á‰£áŠ•áŠ­ áˆµáˆ á‹­áˆáˆ¨áŒ¡ ---</option>
                                <option value="CBE">Commercial Bank of Ethiopia (CBE)</option>
                                <option value="Awash">Awash Bank</option>
                                <option value="Dashen">Dashen Bank</option>
                                <option value="Abyssinia">Bank of Abyssinia</option>
                                <option value="Telebirr">Telebirr</option>
                                <option value="Other">áˆŒáˆ‹ (Other)</option>
                            </select>
                        </div>
                        
                        <div class="input-group">
                            <label for="withdraw-full-name">á‹¨á‰£áˆˆá‰¤á‰± áˆ™áˆ‰ áˆµáˆ (Name of Account Holder):</label>
                            <input type="text" id="withdraw-full-name" placeholder="áˆ™áˆ‰ áˆµáˆ" required>
                        </div>
                        
                        <div class="input-group">
                            <label for="withdraw-account-number">á‹¨áŠ áŠ«á‹áŠ•á‰µ / áˆµáˆáŠ­ á‰áŒ¥áˆ­:</label>
                            <input type="text" id="withdraw-account-number" placeholder="á‹¨á‰£áŠ•áŠ­ áŠ áŠ«á‹áŠ•á‰µ á‰áŒ¥áˆ­ á‹ˆá‹­áˆ Telebirr á‰áŒ¥áˆ­" required>
                        </div>
                        <div class="input-group">
                            <label for="withdraw-amount">á‹¨áŒˆáŠ•á‹˜á‰¥ áˆ˜áŒ áŠ• (Amount) - á‰ ETB:</label>
                            <input type="number" id="withdraw-amount" min="100" placeholder="á‰¢á‹«áŠ•áˆµ 100 ETB" required>
                        </div>
                        
                        <button type="submit" id="withdraw-submit-btn" class="submit-btn">âœ… Withdraw áŒ¥á‹«á‰„ áŠ áˆµáŒˆá‰£</button>
                        <p class="message withdraw-message" id="withdraw-form-message"></p>
                    </form>
                </div>
            </div>
            
        </div>
        
        <div id="investment-content" class="page-content">
            <div class="investment-plans">
                <h3>ğŸ’° á‹¨áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ á‹•á‰…á‹¶á‰½ áŠ¥áŠ“ áŒ¥á‰…áˆ› áŒ¥á‰…áˆá‰½</h3>
                
                <div class="plan-grid" id="plan-grid-list">
                    
                    <button class="plan-button" id="plan-1-btn" data-plan="Basic" data-min="500" data-max="4999" data-rate="7" data-days="40">
                        <h4>Plan 1: áˆ˜áˆ áˆ¨á‰³á‹Š (Basic)</h4>
                        <div class="plan-details">
                            <p>áˆ˜áŒ áŠ•: <strong>ETB 500 - 4,999</strong></p>
                            <p>áŒŠá‹œ: <strong>40 á‰€áŠ“á‰µ</strong></p>
                            <p class="daily-rate">á‹•áˆˆá‰³á‹Š á‰µáˆ­á: 7%</p>
                        </div>
                    </button>

                    <button class="plan-button" id="plan-2-btn" data-plan="Standard" data-min="5000" data-max="9999" data-rate="8" data-days="70">
                        <h4>Plan 2: áˆ˜áŠ«áŠ¨áˆˆáŠ› (Standard)</h4>
                        <div class="plan-details">
                            <p>áˆ˜áŒ áŠ•: <strong>ETB 5,000 - 9,999</strong></p>
                            <p>áŒŠá‹œ: <strong>70 á‰€áŠ“á‰µ</strong></p>
                            <p class="daily-rate">á‹•áˆˆá‰³á‹Š á‰µáˆ­á: 8%</p>
                        </div>
                    </button>

                    <button class="plan-button" id="plan-3-btn" data-plan="Premium" data-min="10000" data-max="1000000" data-rate="9" data-days="100">
                        <h4>Plan 3: á‹‹áŠ“ (Premium)</h4>
                        <div class="plan-details">
                            <p>áˆ˜áŒ áŠ•: <strong>ETB 10,000+</strong></p>
                            <p>áŒŠá‹œ: <strong>100 á‰€áŠ“á‰µ</strong></p>
                            <p class="daily-rate">á‹•áˆˆá‰³á‹Š á‰µáˆ­á: 9%</p>
                        </div>
                    </button>

                    <button class="plan-button" id="plan-4-btn" data-plan="Advanced" data-min="8000" data-max="16000" data-rate="10" data-days="22">
                        <h4>Plan 4: áŠ¨áá‰°áŠ› (Advanced)</h4>
                        <div class="plan-details">
                            <p>áˆ˜áŒ áŠ•: <strong>ETB 8,000 - 16,000</strong></p>
                            <p>áŒŠá‹œ: <strong>22 á‰€áŠ“á‰µ</strong></p>
                            <p class="daily-rate">á‹•áˆˆá‰³á‹Š á‰µáˆ­á: 10%</p>
                        </div>
                    </button>

                    <button class="plan-button" id="plan-5-btn" data-plan="VIP" data-min="18000" data-max="100000000" data-rate="11" data-days="33">
                        <h4>Plan 5: á‰ª.áŠ á‹­.á’ (VIP)</h4>
                        <div class="plan-details">
                            <p>áˆ˜áŒ áŠ•: <strong>ETB 18,000+</strong></p>
                            <p>áŒŠá‹œ: <strong>33 á‰€áŠ“á‰µ</strong></p>
                            <p class="daily-rate">á‹•áˆˆá‰³á‹Š á‰µáˆ­á: 11%</p>
                        </div>
                    </button>

                </div>
                
                <div class="investment-list-display" id="investment-list-display">
                    </div>
                
                <div class="purchase-form-box" id="purchase-form-box" style="display: none;">
                    <button id="back-to-plans-btn" style="float: right; background: #ccc; border: none; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-weight: bold;">âŒ</button>
                    <h4> <span id="selected-plan-name">Selected Plan</span> áŒá‹¢ </h4>
                    <p style="text-align: center; font-size: 15px;">
                        á‹¨áŠ¥áˆ­áˆµá‹ á‰€áˆª áˆ‚áˆ³á‰¥: <strong>ETB <span id="current-balance-purchase">0.00</span></strong>
                    </p>
                    <p id="plan-info-display" style="text-align: center; color: #387c38; font-weight: bold;"></p>
                    <form id="purchase-form">
                        <div class="input-group">
                            <label for="purchase-amount">á‹¨áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ áˆ˜áŒ áŠ• (Amount) - á‰ ETB:</label>
                            <input type="number" id="purchase-amount" required>
                        </div>
                        <button type="submit" id="purchase-submit-btn" class="submit-btn" style="width: 100%; margin-top: 10px;">âœ… áŒá‹¢ áˆáŒ½áˆ</button>
                        <p class="message purchase-message" id="purchase-form-message" style="text-align: center;"></p>
                    </form>
                </div>
            </div>
        </div>
        
        <div id="team-content" class="page-content">
            <h3>ğŸ‘¥ á‹¨áŠ” á‰¡á‹µáŠ• (My Team)</h3>
            <div style="text-align: center; margin-bottom: 20px;">
                <p style="font-size: 18px;">
                    **á‹¨áŠ¥áˆ­áˆµá‹ Referral Code:** <strong style="color: #1e5a2c; font-size: 24px;" id="referral-code-display">...</strong>
                </p>
                <p style="font-size: 16px; color: #555;">
                    á‹¨á‰¡á‹µáŠ• áŠ á‰£áˆ‹á‰µ á‰¥á‹›á‰µ (Level 1): <strong id="team-size-display">0</strong>
                </p>
            </div>
            
            <h4 style="color: #387c38; margin-top: 30px;">ğŸŒŸ Referral Link (áˆ¼áˆ­ á‹«á‹µáˆ­áŒ‰)</h4>
            <div style="background-color: #f0f0f0; padding: 15px; border-radius: 8px; border: 1px dashed #ccc;">
                <input type="text" id="referral-link-display" readonly style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; font-size: 15px; margin-bottom: 10px; cursor: text;">
                <button id="copy-referral-link-btn" class="submit-btn" type="button" style="width: 100%; background-color: #008CBA; padding: 10px; font-size: 15px;">ğŸ”— Referral Link áŠ®á’ áŠ á‹µáˆ­áŒ</button>
            </div>
            <h4 style="color: #1e5a2c; margin-top: 30px;">á‹¨á‰¡á‹µáŠ• á‹¨á‰µáˆ­á á‹µáˆ­áˆ» áˆ˜áˆ¨áŒƒ</h4>
            <p>áŠ¨á‰¡á‹µáŠ•á‹ áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ 10% á‹•áˆˆá‰³á‹Š á‰µáˆ­á á‹«áŒˆáŠ›áˆ‰á¢</p>

        </div>
        
        <div id="customer-service-content" class="page-content other-page">
            <h3>ğŸ“ á‹¨á‹°áŠ•á‰ áŠ› áŠ áŒˆáˆáŒáˆá‰µ (Customer Service)</h3>
            <p style="text-align: center; margin-bottom: 30px; color: #555;">áˆˆáˆ›áŠ•áŠ›á‹áˆ áŒ¥á‹«á‰„á£ áŠ áˆµá‰°á‹«á‹¨á‰µ á‹ˆá‹­áˆ á‹µáŒ‹á áŠ¨á‰³á‰½ á‰ á‰°áŒ á‰€áˆ±á‰µ áˆ˜áŠ•áŒˆá‹¶á‰½ á‹«áŒáŠ™áŠ•á¢</p>

            <div class="account-buttons">
                 <a href="https://t.me/missleyu67" target="_blank" class="submit-btn" style="background-color: #0088cc; color: white; padding: 15px; text-decoration: none; font-weight: bold; font-size: 16px; border-radius: 8px;"> ğŸ’¬ á‹¨á‹°áŠ•á‰ áŠ› áŠ áŒˆáˆáŒáˆá‰µ / Customer Care (@missleyu67) </a>
                
                <a href="https://t.me/agro_chemical_investmen_aci" target="_blank" class="submit-btn" style="background-color: #008CBA; color: white; padding: 15px; text-decoration: none; font-weight: bold; font-size: 16px; border-radius: 8px;"> ğŸ“¢ áŠ¦áŠáˆ´áˆ‹á‹Š á‰»áŠ“áˆ / Channel (News) </a>
                
                <a href="https://t.me/+EWb9Ud11obowNTFk" target="_blank" class="submit-btn" style="background-color: #4CAF50; color: white; padding: 15px; text-decoration: none; font-weight: bold; font-size: 16px; border-radius: 8px;"> ğŸ‘¥ á‹¨á‹µáŒ‹á áŒáˆ©á• / Support Group </a>
            </div>
            
        </div>
        
        <div id="account-content" class="page-content other-page">
            <h3>ğŸ‘¤ á‹¨áŠ” áˆ˜áˆˆá‹« (My Account)</h3>
            <div class="account-details">
                <p>á‹­áˆ… áŒˆáŒ½ á‹¨áŠ¥áˆ­áˆµá‹áŠ• á‹¨áŒáˆ áˆ˜áˆ¨áŒƒá‹á‰½ (áˆµáˆáŠ­ á‰áŒ¥áˆ­á£ á‹¨á‹­áˆˆá á‰ƒáˆ áˆ˜á‰€á‹¨áˆ­á‹« á‹ˆá‹˜á‰°) á‹­á‹­á‹›áˆá¢</p>
                <p><strong>á‹¨áˆ˜áˆˆá‹« áˆ˜áˆ¨áŒƒá¡</strong> <span id="account-info">áˆµáˆáŠ­: ... | áˆ™áˆ‰ áˆµáˆ: ...</span></p>
            </div>
            
            <div class="account-buttons">
                <button id="transaction-history-btn" type="button">ğŸ§¾ Transaction History (á‹¨á‹á‹á‹áˆ­ á‰³áˆªáŠ­)</button>
                <button id="change-password-btn" type="button">ğŸ”‘ á‹¨á‹­áˆˆá á‰ƒáˆ á‰€á‹­áˆ­ (Change Password)</button>
                <button id="logout-btn-account" type="button">ğŸšª Logout (á‹áŒ£)</button>
            </div>
            
            <p class="message" id="history-message" style="margin-top: 20px; text-align: center;"></p>
            
        </div>
        
        <div id="history-content" class="page-content other-page" style="display: none;">
            <button id="back-to-account-from-history-btn" style="float: left; background: #f0f0f0; border: 1px solid #ccc; padding: 10px; border-radius: 5px; cursor: pointer; margin-bottom: 15px;">ğŸ”™ á‹ˆá‹° Account á‰°áˆ˜áˆˆáˆµ</button>
            <div style="clear: both;"></div>
            <h3>ğŸ§¾ á‹¨á‹á‹á‹áˆ­ á‰³áˆªáŠ­ (Transaction History)</h3>
            <div id="transaction-history-list">
                </div>
        </div>
        
        <div id="change-password-content" class="page-content other-page" style="display: none;">
            <button id="back-to-account-from-password-btn" style="float: left; background: #f0f0f0; border: 1px solid #ccc; padding: 10px; border-radius: 5px; cursor: pointer; margin-bottom: 15px;">ğŸ”™ á‹ˆá‹° Account á‰°áˆ˜áˆˆáˆµ</button>
            <div style="clear: both;"></div>
            <h3>ğŸ”‘ á‹¨á‹­áˆˆá á‰ƒáˆ á‰€á‹­áˆ­</h3>
            
            <form id="change-password-form" style="max-width: 350px; margin: 0 auto;">
                <div class="input-group">
                    <label for="current-password">áŠ áˆáŠ• á‹«áˆˆ á‹¨á‹­áˆˆá  á‰ƒáˆ:</label>
                    <input type="password" id="current-password" required>
                </div>
                <div class="input-group">
                    <label for="new-password">áŠ á‹²áˆµ á‹¨á‹­áˆˆá á‰ƒáˆ (á‰¢á‹«áŠ•áˆµ 6 áŠá‹°áˆ):</label>
                    <input type="password" id="new-password" required minlength="6">
                </div>
                <div class="input-group">
                    <label for="confirm-new-password">áŠ á‹²áˆµ á‹¨á‹­áˆˆá á‰ƒáˆ áˆ›áˆ¨áŒ‹áŒˆáŒ«:</label>
                    <input type="password" id="confirm-new-password" required minlength="6">
                </div>
                <button type="submit" class="submit-btn" style="width: 100%;">âœ… á‹¨á‹­áˆˆá á‰ƒáˆ á‰€á‹­áˆ­</button>
                <p class="message" id="change-password-message" style="text-align: center;"></p>
            </form>
        </div>
        
        <div class="bottom-navbar">
            <button id="nav-home" class="nav-active">Home</button>
            <button id="nav-investment">Investment</button>
            <button id="nav-team">Team</button>
            <button id="nav-customer-service">Customer Service</button>
            <button id="nav-account">Account</button>
        </div>
        
    </div>
    
    <div id="admin-dashboard-area" class="admin-dashboard-page">
        <div class="admin-header">
            <h2>ğŸš¨ ADMIN CONTROL PANEL</h2>
        </div>
        
        <div class="admin-nav-tabs">
            <button id="admin-nav-transactions" class="admin-nav-active">Transaction Approvals</button>
            <button id="admin-nav-investments">Investment Control</button>
        </div>
        
        <div id="admin-transactions-content" class="admin-page-content active">
            <h3>ğŸ’° Deposit/Withdraw áŒ¥á‹«á‰„á‹á‰½</h3>
            <div class="admin-transaction-list" id="pending-transactions-list">
                </div>
        </div>
        
        <div id="admin-investments-content" class="admin-page-content">
            <h3>ğŸ“ˆ á‹¨áŠá‰ áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰¶á‰½ (Active Investments)</h3>
            <div class="admin-transaction-list" id="admin-investment-list">
                </div>
        </div>

        <button id="admin-logout-btn" class="admin-logout-btn">ğŸšª Logout (á‹áŒ£)</button>

    </div>


    <script>
        // ********** 1. FIREBASE CONFIGURATION **********
        const firebaseConfig = {
            apiKey: "AIzaSyDu7AqPVMcvSR-hA6VO7zfVCd9XhJvQFcs",
            authDomain: "mmmm-c2cc3.firebaseapp.com",
            databaseURL: "https://mmmm-c2cc3-default-rtdb.firebaseio.com",
            projectId: "mmmm-c2cc3",
            storageBucket: "mmmm-c2cc3.appspot.com",
            messagingSenderId: "367069720455",
            appId: "1:367069720455:web:53173d19114f24f54d5d1c"
        };
        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const database = firebase.database();
        const usersRef = database.ref('users');

        // Admin Credentials
        const adminCredentials = {
            identifier: 'admin',
            password: 'a226776'
        };

        // ********** 2. GLOBAL STATE **********
        let activeUser = null; // Currently logged in user object
        let isAdmin = null;

        // ********** 3. DOM ELEMENTS **********
        // Login/Register elements
        const loginRegisterArea = document.getElementById('login-register-area');
        const loginTab = document.getElementById('login-tab');
        const registerTab = document.getElementById('register-tab');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginMessage = document.getElementById('login-message');
        const registerMessage = document.getElementById('register-message');
        const goToRegisterLink = document.getElementById('go-to-register');
        const goToLoginLink = document.getElementById('go-to-login');

        // Dashboard elements
        const dashboardArea = document.getElementById('dashboard-area');
        const userNameDisplay = document.getElementById('user-name');
        const currentBalanceDisplay = document.getElementById('current-balance');
        const totalInvestedAmountDisplay = document.getElementById('total-invested-amount');
        const dailyProfitDisplay = document.getElementById('daily-profit-display');
        const investmentListDisplay = document.getElementById('investment-list-display');
        const teamSizeDisplay = document.getElementById('team-size-display');
        const referralCodeDisplay = document.getElementById('referral-code-display');
        const referralLinkDisplay = document.getElementById('referral-link-display'); // NEW
        const copyReferralLinkBtn = document.getElementById('copy-referral-link-btn'); // NEW

        // Navigation elements
        const navHome = document.getElementById('nav-home');
        const navInvestment = document.getElementById('nav-investment');
        const navCustomerService = document.getElementById('nav-customer-service');
        const navAccount = document.getElementById('nav-account');
        const navTeam = document.getElementById('nav-team');
        const allNavButtons = document.querySelectorAll('.bottom-navbar button');

        // Content sections
        const allContentSections = document.querySelectorAll('.page-content');
        const homeContent = document.getElementById('home-content');
        const investmentContent = document.getElementById('investment-content');
        const customerServiceContent = document.getElementById('customer-service-content');
        const accountContent = document.getElementById('account-content');
        const teamContent = document.getElementById('team-content');
        
        // Home page buttons/divs
        const depositBtn = document.getElementById('deposit-btn');
        const withdrawBtn = document.getElementById('withdraw-btn');
        const mainHomeContentDiv = document.getElementById('main-home-content-div');
        const depositPageContentDiv = document.getElementById('deposit-page-content-div');
        const withdrawPageContentDiv = document.getElementById('withdraw-page-content-div');
        const backToHomeFromDepositBtn = document.getElementById('back-to-home-from-deposit-btn');
        const backToHomeFromWithdrawBtn = document.getElementById('back-to-home-from-withdraw-btn');

        // Deposit form elements
        const depositForm = document.getElementById('deposit-form');
        const depositAmountInput = document.getElementById('deposit-amount');
        const transactionIdInput = document.getElementById('transaction-id');
        const depositFormMessage = document.getElementById('deposit-form-message');

        // Withdraw form elements
        const withdrawForm = document.getElementById('withdraw-form');
        const withdrawBankNameInput = document.getElementById('withdraw-bank-name');
        const withdrawFullNameInput = document.getElementById('withdraw-full-name');
        const withdrawAccountNumberInput = document.getElementById('withdraw-account-number');
        const withdrawAmountInput = document.getElementById('withdraw-amount');
        const withdrawFormMessage = document.getElementById('withdraw-form-message');

        // Investment page elements
        const planButtons = document.querySelectorAll('.plan-button');
        const purchaseFormBox = document.getElementById('purchase-form-box');
        const backToPlansBtn = document.getElementById('back-to-plans-btn');
        const selectedPlanNameDisplay = document.getElementById('selected-plan-name');
        const currentBalancePurchaseDisplay = document.getElementById('current-balance-purchase');
        const planInfoDisplay = document.getElementById('plan-info-display');
        const purchaseForm = document.getElementById('purchase-form');
        const purchaseAmountInput = document.getElementById('purchase-amount');
        const purchaseFormMessage = document.getElementById('purchase-form-message');
        let selectedPlan = null; // To hold the currently selected plan data

        // Account page elements
        const transactionHistoryBtn = document.getElementById('transaction-history-btn');
        const changePasswordBtn = document.getElementById('change-password-btn');
        const logoutBtnAccount = document.getElementById('logout-btn-account');
        
        // History Page elements
        const historyContent = document.getElementById('history-content');
        const backToAccountFromHistoryBtn = document.getElementById('back-to-account-from-history-btn');
        const transactionHistoryList = document.getElementById('transaction-history-list');
        
        // Change Password Page elements
        const changePasswordContent = document.getElementById('change-password-content');
        const backToAccountFromPasswordBtn = document.getElementById('back-to-account-from-password-btn');
        const changePasswordForm = document.getElementById('change-password-form');
        const changePasswordMessage = document.getElementById('change-password-message');

        // Admin elements
        const adminDashboardArea = document.getElementById('admin-dashboard-area');
        const adminNavTransactions = document.getElementById('admin-nav-transactions');
        const adminNavInvestments = document.getElementById('admin-nav-investments');
        const adminTransactionsContent = document.getElementById('admin-transactions-content');
        const adminInvestmentsContent = document.getElementById('admin-investments-content');
        const pendingTransactionsList = document.getElementById('pending-transactions-list');
        const adminInvestmentList = document.getElementById('admin-investment-list');
        const adminLogoutBtn = document.getElementById('admin-logout-btn');


        // ********** 4. FIREBASE UTILITIES **********
        // Helper function to get user data by phone number (identifier)
        async function getUserData(identifier) {
            try {
                const snapshot = await usersRef.child(identifier).once('value');
                return snapshot.val();
            } catch (error) {
                console.error("Error fetching user data:", error);
                return null;
            }
        }

        // Helper function to update user data
        async function updateUserData(identifier, data) {
            try {
                await usersRef.child(identifier).update(data);
                return true;
            } catch (error) {
                console.error("Error updating user data:", error);
                return false;
            }
        }

        // Helper function to get all user data
        async function getAllUsersData() {
            try {
                const snapshot = await usersRef.once('value');
                return snapshot.val() || {};
            } catch (error) {
                console.error("Error fetching all users data:", error);
                return {};
            }
        }

        // Utility to switch between Login/Register tabs
        function switchAuthTab(tabId) {
            document.getElementById('login-tab').classList.remove('active');
            document.getElementById('register-tab').classList.remove('active');
            document.getElementById('login-form').classList.remove('active');
            document.getElementById('register-form').classList.remove('active');

            if (tabId === 'login') {
                document.getElementById('login-tab').classList.add('active');
                document.getElementById('login-form').classList.add('active');
            } else {
                document.getElementById('register-tab').classList.add('active');
                document.getElementById('register-form').classList.add('active');
            }
            loginMessage.textContent = '';
            registerMessage.textContent = '';
        }

        // Function to handle logout
        function logout() {
            activeUser = null;
            isAdmin = false;
            // Clear all areas and show login page
            dashboardArea.style.display = 'none';
            adminDashboardArea.style.display = 'none';
            loginRegisterArea.style.display = 'flex';
            
            // Redirect to base URL to clear referral params
            window.location.href = window.location.origin;
            
            // switchAuthTab('login'); // Not needed if redirecting
        }

        // ********** 5. CORE DASHBOARD LOGIC **********
        // Investment Profit Calculation and Update (CRITICAL FUNCTION)
        async function calculateAndDistributeProfit(userId) {
            const user = await getUserData(userId);
            if (!user || !user.investments) return;

            // Get last profit calculation date or use registration date if none exists
            const lastCalcDate = user.lastProfitCalculated ? new Date(user.lastProfitCalculated) : new Date(user.registrationDate);
            const now = new Date();
            
            // Check for a full day difference (24 hours)
            const diffTime = now.getTime() - lastCalcDate.getTime();
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)); 

            if (diffDays < 1) return; // No need to calculate if less than a day passed

            let totalProfit = 0;
            let referralCommission = 0;
            
            // 1. Calculate main investment profit
            let investmentsArray = Array.isArray(user.investments) ? user.investments : (user.investments ? Object.values(user.investments) : []);
            investmentsArray.forEach(inv => {
                if (inv.daysLeft > 0) {
                    const dailyProfit = inv.amount * (inv.rate / 100);
                    const accumulatedProfit = dailyProfit * diffDays;
                    
                    // Decrease days left by diffDays
                    inv.daysLeft = Math.max(0, inv.daysLeft - diffDays);
                    inv.profitEarned = (inv.profitEarned || 0) + accumulatedProfit;
                    totalProfit += accumulatedProfit;
                }
            });
            user.investments = investmentsArray;

            // 2. Calculate referral commission (10% of the daily profit of the referee)
            const allUsers = await getAllUsersData();
            const level1Users = Object.values(allUsers).filter(refUser => refUser.referredBy === userId);

            if (level1Users.length > 0) {
                level1Users.forEach(refUser => {
                    let refTotalDailyProfit = 0;
                    const refInvestmentsArray = Array.isArray(refUser.investments) ? refUser.investments : (refUser.investments ? Object.values(refUser.investments) : []);
                    
                    refInvestmentsArray.forEach(refInv => {
                        if (refInv.daysLeft > 0) {
                            // Using the maximum possible daily profit rate for calculation, assuming daily profit distribution
                            refTotalDailyProfit += refInv.amount * (refInv.rate / 100); 
                        }
                    });

                    if (refTotalDailyProfit > 0) {
                        const commission = refTotalDailyProfit * 0.10; // 10% commission
                        referralCommission += commission * diffDays; // áˆˆáŠá‹šáˆ… á‰€áŠ“á‰µ á‹¨á‰°áŒ áˆ«á‰€áˆ˜ áŠ®áˆšáˆ½áŠ•
                    }
                });
            }


            const totalEarning = totalProfit + referralCommission;

            if (totalEarning > 0) {
                // 3. Update User Balance and Transaction History
                user.balance = (user.balance || 0) + totalEarning;

                const profitTx = {
                    id: 'tx_profit_' + Date.now(),
                    type: "Daily Profit",
                    amount: totalEarning,
                    date: new Date().toISOString().slice(0, 10),
                    status: "Completed",
                    details: `Daily Profit (${totalProfit.toFixed(2)} ETB) + Referral Commission (${referralCommission.toFixed(2)} ETB) for ${diffDays} days`
                };

                let transactionsArray = Array.isArray(user.transactions) ? user.transactions : (user.transactions ? Object.values(user.transactions) : []);
                transactionsArray.push(profitTx);
                user.transactions = transactionsArray;

                // 4. Update the last calculation time to NOW
                user.lastProfitCalculated = now.toISOString();

                // 5. Save all changes back to Firebase
                await updateUserData(userId, {
                    balance: user.balance,
                    transactions: user.transactions,
                    investments: user.investments,
                    lastProfitCalculated: user.lastProfitCalculated
                });
            }
        }

        // Dashboard Data Update and UI Refresh
        async function updateDashboardData() {
            if (!activeUser) return logout();

            // 1. Calculate and distribute any outstanding profit first
            await calculateAndDistributeProfit(activeUser.identifier);

            // 2. Refetch the updated user data
            activeUser = await getUserData(activeUser.identifier);
            if (!activeUser) return logout(); // User somehow deleted

            // 3. UI Update
            userNameDisplay.textContent = `áŠ¥áŠ•áŠ³áŠ• á‹°áˆ…áŠ“ áˆ˜áŒ¡! ${activeUser.name}`;
            const balance = activeUser.balance || 0;
            currentBalanceDisplay.textContent = balance.toFixed(2);
            totalInvestedAmountDisplay.textContent = (activeUser.totalInvested || 0).toFixed(2);
            currentBalancePurchaseDisplay.textContent = balance.toFixed(2); // For investment page

            // 4. á‹•áˆˆá‰³á‹Š áŠ¨áá‰°áŠ› á‰µáˆ­á áˆµáˆŒá‰µ (Daily Maximum Profit Calculation)
            let currentMaxDailyProfit = 0;
            let investmentsArray = Array.isArray(activeUser.investments) ? activeUser.investments : (activeUser.investments ? Object.values(activeUser.investments) : []);
            
            investmentsArray.forEach(inv => {
                if (inv.daysLeft > 0) {
                    currentMaxDailyProfit += inv.amount * (inv.rate / 100);
                }
            });

            // Referral Daily Commission (Based on active investments of L1 team)
            const allUsers = await getAllUsersData();
            const level1Users = Object.values(allUsers).filter(refUser => refUser.referredBy === activeUser.identifier);

            if (level1Users.length > 0) {
                level1Users.forEach(refUser => {
                    const refInvestmentsArray = Array.isArray(refUser.investments) ? refUser.investments : (refUser.investments ? Object.values(refUser.investments) : []);
                    let refTotalDailyProfit = 0;
                    refInvestmentsArray.forEach(refInv => {
                        if (refInv.daysLeft > 0) {
                             // Using the maximum possible daily profit rate for calculation
                            refTotalDailyProfit += refInv.amount * (refInv.rate / 100); 
                        }
                    });
                    if (refTotalDailyProfit > 0) {
                        currentMaxDailyProfit += refTotalDailyProfit * 0.10; // 10% commission
                    }
                });
            }
            dailyProfitDisplay.textContent = currentMaxDailyProfit.toFixed(2); // Display the calculated total max daily profit


            // 5. áˆªáˆáˆ«áˆ áŠ®á‹±áŠ• áˆ›áˆ³á‹¨á‰µ
            referralCodeDisplay.textContent = activeUser.referralCode;
            
            // NEW: áˆªáˆáˆ«áˆ áˆŠáŠ•áŠ­áŠ• áˆ›áˆ³á‹¨á‰µ
            const baseURL = window.location.origin + window.location.pathname; // á‹­áˆ… áŠ áˆáŠ• á‹«áˆˆá‰ á‰µáŠ• áŒˆáŒ½ áŠ á‹µáˆ«áˆ» á‹­á‹ˆáˆµá‹³áˆ (áˆˆáˆáˆ³áˆŒ: https://ag-project-pi.vercel.app/)
            const referralLink = `${baseURL}?ref=${activeUser.referralCode}`;
            if (referralLinkDisplay) {
                referralLinkDisplay.value = referralLink;
            }

            // 6. áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰¶á‰½áŠ• áˆ›áˆ³á‹¨á‰µ
            displayInvestments();

            // 7. á‹¨á‰¡á‹µáŠ• áˆ˜áŒ áŠ• áˆ›áˆ³á‹¨á‰µ
            updateTeamData();
            
            // 8. á‹¨áˆ˜áˆˆá‹« áˆ˜áˆ¨áŒƒáŠ• áˆ›áˆ³á‹¨á‰µ
            document.getElementById('account-info').textContent = `áˆµáˆáŠ­: ${activeUser.identifier} | áˆ™áˆ‰ áˆµáˆ: ${activeUser.name}`;
        }

        // á‹¨á‰¡á‹µáŠ• áˆ˜áŒ áŠ• áˆ›áˆ³á‹«
        async function updateTeamData() {
            if (!activeUser) return;
            const allUsers = await getAllUsersData();
            const allUsersArray = Object.values(allUsers);
            const level1Users = allUsersArray.filter(refUser => refUser.referredBy === activeUser.identifier);
            activeUser.teamSize = level1Users.length; // DB áˆ‹á‹­ á‹¨áˆ›á‹«áˆµáˆáˆáŒ á‰¢áˆ†áŠ•áˆ áˆˆáŒŠá‹œá‹
            teamSizeDisplay.textContent = level1Users.length;
        }

        // Display User Investments on Investment Page
        function displayInvestments() {
            if (!activeUser || !activeUser.investments) {
                investmentListDisplay.innerHTML = '<p style="text-align: center; color: #555;">áŒˆáŠ“ áˆáŠ•áˆ áŠ¢áŠ•á‰¨áˆµá‰µ áŠ áˆ‹á‹°áˆ¨áŒ‰áˆá¢</p>';
                return;
            }

            const investmentsArray = Array.isArray(activeUser.investments) ? activeUser.investments : Object.values(activeUser.investments);
            let html = '';
            
            // Sort by newest first
            investmentsArray.sort((a, b) => new Date(b.startDate) - new Date(a.startDate));

            investmentsArray.forEach(inv => {
                // Days Left is used to determine status. If <= 0, it's ended/completed.
                const status = inv.daysLeft > 0 ? 'Active' : 'Ended/Completed';
                const statusColor = inv.daysLeft > 0 ? '#387c38' : '#f44336';
                const daysDisplay = inv.daysLeft > 0 ? `<span style="font-weight: bold; color: ${statusColor};">${inv.daysLeft}</span> / ${inv.daysTotal} á‰€áŠ“á‰µ` : 'á‰°áŒ áŠ“á‰‹áˆ!';
                const profitStatusColor = (inv.profitEarned > 0) ? '#1e5a2c' : '#555';
                
                html += `
                    <div style="border: 1px solid #ddd; padding: 10px; margin-bottom: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); border-left: 5px solid ${statusColor};">
                        <p style="margin: 3px 0; font-size: 15px;"><strong>á‹•á‰…á‹µ:</strong> ${inv.name} | <strong>áˆ˜áŒ áŠ•:</strong> ${inv.amount.toFixed(2)} ETB</p>
                        <p style="margin: 3px 0; font-size: 15px;"><strong>á‹•áˆˆá‰³á‹Š á‰µáˆ­á:</strong> ${inv.rate}%</p>
                        <p style="margin: 3px 0; font-size: 15px;"><strong>á‹¨áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ áŒŠá‹œ:</strong> ${daysDisplay}</p>
                        <p style="margin: 3px 0; font-size: 15px; color: ${profitStatusColor};"><strong>á‹¨á‰°áŒˆáŠ˜ á‰µáˆ­á (Profit Earned):</strong> ${inv.profitEarned.toFixed(2)} ETB</p>
                        <p style="margin: 3px 0; font-size: 14px;"><strong>áˆáŠ”á‰³:</strong> <span style="font-weight: bold; color: ${statusColor};">${status}</span></p>
                    </div>
                `;
            });

            investmentListDisplay.innerHTML = html;
        }

        // Display transaction history
        function displayTransactionHistory() {
            if (!activeUser || !activeUser.transactions) {
                transactionHistoryList.innerHTML = '<p style="text-align: center; color: #555;">áˆáŠ•áˆ á‹¨á‹á‹á‹áˆ­ á‰³áˆªáŠ­ á‹¨áˆˆáˆá¢</p>';
                return;
            }
            
            let transactionsArray = Array.isArray(activeUser.transactions) ? activeUser.transactions : Object.values(activeUser.transactions);
            // Sort by newest first
            transactionsArray.sort((a, b) => new Date(b.id.split('_')[2]) - new Date(a.id.split('_')[2]));

            let historyHTML = '<table style="width:100%; border-collapse: collapse; margin-top: 15px;">';
            historyHTML += '<thead><tr style="background-color: #f2f2f2; text-align: left;"><th>á‰€áŠ•</th><th>á‹“á‹­áŠá‰µ</th><th>áˆ˜áŒ áŠ•</th><th>áˆáŠ”á‰³</th></tr></thead><tbody>';

            transactionsArray.forEach(tx => {
                const statusClass = `status-${tx.status}`;
                const sign = tx.type.includes('Deposit') || tx.type.includes('Bonus') || tx.type.includes('Profit') ? '+' : (tx.type.includes('Withdraw') || tx.type.includes('Purchase') ? '' : '');
                const color = sign === '+' ? '#387c38' : (tx.type.includes('Withdraw') || tx.type.includes('Purchase') ? '#f44336' : '#555');
                let amountDisplay = tx.type.includes('Purchase') ? `-${Math.abs(tx.amount).toFixed(2)}` : `${sign}${tx.amount.toFixed(2)}`;

                historyHTML += `
                    <tr>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${tx.date}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;">${tx.type}</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee; color: ${color}; font-weight: bold;">${amountDisplay} ETB</td>
                        <td style="padding: 10px; border-bottom: 1px solid #eee;"><span class="${statusClass}">${tx.status}</span></td>
                    </tr>
                `;
            });

            historyHTML += '</tbody></table>';
            transactionHistoryList.innerHTML = historyHTML;
        }


        // ********** 5.1. ADMIN LOGIC **********
        // Utility to switch between admin tabs
        function switchAdminPage(pageId) {
            const allAdminPages = document.querySelectorAll('.admin-page-content');
            const allAdminNavs = document.querySelectorAll('.admin-nav-tabs button');
            allAdminPages.forEach(page => page.classList.remove('active'));
            allAdminNavs.forEach(nav => nav.classList.remove('admin-nav-active'));

            if (pageId === 'transactions') {
                adminTransactionsContent.classList.add('active');
                adminNavTransactions.classList.add('admin-nav-active');
                displayPendingTransactions();
            } else if (pageId === 'investments') {
                adminInvestmentsContent.classList.add('active');
                adminNavInvestments.classList.add('admin-nav-active');
                displayUserInvestmentsForAdmin();
            }
        }

        // Display all pending transactions for admin
        async function displayPendingTransactions() {
                if (!isAdmin) return;
                pendingTransactionsList.innerHTML = '<p style="text-align: center; color: #555;">Loading...</p>';

            const allUsers = await getAllUsersData();
            const pendingTxs = [];

            // Iterate through all users and collect pending transactions
            Object.keys(allUsers).forEach(userId => {
                const user = allUsers[userId];
                const transactionsArray = Array.isArray(user.transactions) ? user.transactions : (user.transactions ? Object.values(user.transactions) : []);

                transactionsArray.forEach(tx => {
                    if (tx.status === 'Pending') {
                        pendingTxs.push({
                            ...tx,
                            userName: user.name,
                            userId: user.identifier // The user's phone number
                        });
                    }
                });
            });

            pendingTransactionsList.innerHTML = ''; // Clear existing list
            if (pendingTxs.length === 0) {
                pendingTransactionsList.innerHTML = '<p style="text-align: center; color: #555;">áˆáŠ•áˆ á‰ áˆ˜áŒ á‰£á‰ á‰… áˆ‹á‹­ á‹«áˆˆ áŒ¥á‹«á‰„ á‹¨áˆˆáˆá¢</p>';
                return;
            }

            pendingTxs.forEach(tx => {
                const info = tx.type === 'Deposit' ? 
                            `Transaction ID: ${tx.id}` : 
                            `Bank: ${tx.bankName} | Account: ${tx.accountNumber} | Name: ${tx.fullName}`;
                const actionType = tx.type === 'Deposit' ? 'Deposit' : 'Withdraw';
                
                pendingTransactionsList.innerHTML += `
                    <div class="admin-transaction-item" style="border-left: 5px solid ${actionType === 'Deposit' ? '#4CAF50' : '#f44336'};">
                        <div class="admin-transaction-info">
                            <p><strong>á‰°áŒ á‰ƒáˆš:</strong> ${tx.userName} (${tx.userId})</p>
                            <p><strong>á‹“á‹­áŠá‰µ:</strong> ${tx.type} | <strong>áˆ˜áŒ áŠ•:</strong> ${tx.amount.toFixed(2)} ETB</p>
                            <p><strong>á‰€áŠ•:</strong> ${tx.date}</p>
                            <p><strong>á‹áˆ­á‹áˆ­:</strong> ${info}</p>
                        </div>
                        <div class="admin-actions">
                            <button class="approve-btn" data-tx-id="${tx.id}" data-user-id="${tx.userId}" data-type="${tx.type}" data-amount="${tx.amount}">âœ… Approve</button>
                            <button class="reject-btn" data-tx-id="${tx.id}" data-user-id="${tx.userId}" data-type="${tx.type}" data-amount="${tx.amount}">âŒ Reject</button>
                        </div>
                    </div>
                `;
            });

            // Add event listeners for the new buttons
            document.querySelectorAll('.approve-btn, .reject-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const txId = this.getAttribute('data-tx-id');
                    const userId = this.getAttribute('data-user-id');
                    const txType = this.getAttribute('data-type');
                    const txAmount = parseFloat(this.getAttribute('data-amount'));
                    const status = this.classList.contains('approve-btn') ? 'Completed' : 'Rejected';
                    handleTransactionApproval(userId, txId, txType, txAmount, status);
                });
            });
        }

        // Admin function to approve or reject transactions
        async function handleTransactionApproval(userId, txId, txType, txAmount, status) {
            if (!isAdmin) return;

            const user = await getUserData(userId);
            if (!user) {
                alert("âš ï¸ á‰°áŒ á‰ƒáˆšá‹ áŠ áˆá‰°áŒˆáŠ˜áˆá¢");
                return;
            }

            let userTxs = Array.isArray(user.transactions) ? user.transactions : Object.values(user.transactions);
            const transactionIndex = userTxs.findIndex(tx => tx.id === txId && tx.status === 'Pending');

            if (transactionIndex === -1) {
                alert("âš ï¸ á‹¨á‹á‹á‹áˆ­ áŒ¥á‹«á‰„á‹ á‰°áˆ°áˆ­á‹Ÿáˆ á‹ˆá‹­áˆ áŠ áˆá‰°áŒˆáŠ˜áˆá¢");
                displayPendingTransactions(); // Refresh list
                return;
            }

            userTxs[transactionIndex].status = status;

            if (status === 'Completed') {
                if (txType === 'Deposit') {
                    user.balance = (user.balance || 0) + txAmount;
                    alert(`âœ… á‹¨ ${txAmount.toFixed(2)} ETB Deposit áŒ¥á‹«á‰„ á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á€á‹µá‰‹áˆá¢ áŒˆáŠ•á‹˜á‰¡ áŒˆá‰¥á‰·áˆá¢`);
                } else if (txType === 'Withdraw') {
                    // Withdraw was already deducted on user side, just confirm
                    alert(`âœ… á‹¨ ${txAmount.toFixed(2)} ETB Withdraw áŒ¥á‹«á‰„ á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á€á‹µá‰‹áˆá¢ áŒˆáŠ•á‹˜á‰¡ á‹­áˆˆá‰€á‰ƒáˆá¢`);
                }
            } else if (status === 'Rejected') {
                if (txType === 'Withdraw') {
                    // Refund the money for a rejected withdraw
                    user.balance = (user.balance || 0) + txAmount;
                    alert(`âŒ á‹¨ ${txAmount.toFixed(2)} ETB Withdraw áŒ¥á‹«á‰„ á‹á‹µá‰… á‰°á‹°áˆ­áŒ“áˆá¢ áŒˆáŠ•á‹˜á‰¡ á‰°áˆ˜áˆáˆ·áˆá¢`);
                } else if (txType === 'Deposit') {
                    alert(`âŒ á‹¨ ${txAmount.toFixed(2)} ETB Deposit áŒ¥á‹«á‰„ á‹á‹µá‰… á‰°á‹°áˆ­áŒ“áˆá¢`);
                }
            }

            // Update the user object in Firebase
            await updateUserData(userId, {
                balance: user.balance,
                transactions: userTxs // á‹¨á‰°áˆ»áˆ»áˆˆá‹ Transaction array
            });

            // á‹áˆ­á‹áˆ©áŠ• áˆ›á‹°áˆµ
            displayPendingTransactions();
            
            // á‰°áŒ á‰ƒáˆšá‹ áŒˆá‰¥á‰¶ áŠ¨áˆ†áŠ á‹¨ Dashboard á‹³á‰³á‹áŠ• áˆ›á‹°áˆµ (áˆˆá‰°áŒ á‰ƒáˆšá‹ áˆ›áˆ³á‹¨á‰µ)
            if (activeUser && activeUser.identifier === user.identifier) {
                updateDashboardData();
            }
        }

        // Display all user investments for admin control
        async function displayUserInvestmentsForAdmin() {
            if (!isAdmin) return;
            adminInvestmentList.innerHTML = '<p style="text-align: center; color: #555;">Loading...</p>';
            try {
                const allUsers = await getAllUsersData();
                let invHtml = '';
                const allInvestments = [];

                // Collect all investments from all users
                Object.keys(allUsers).forEach(userId => {
                    const user = allUsers[userId];
                    const investmentsArray = Array.isArray(user.investments) ? user.investments : (user.investments ? Object.values(user.investments) : []);
                    
                    investmentsArray.forEach(inv => {
                        allInvestments.push({
                            ...inv,
                            userName: user.name,
                            userId: user.identifier
                        });
                    });
                });
                
                // Sort by newest first
                allInvestments.sort((a, b) => new Date(b.startDate) - new Date(a.startDate));

                allInvestments.forEach(inv => {
                    let actionButton = '';
                    const daysLeft = inv.daysLeft || 0;
                    const statusColor = daysLeft > 0 ? '#387c38' : '#f44336';
                    const daysToResume = inv.daysLeft < 0 ? `(Resumes in ${Math.abs(daysLeft)} days)` : ''; // Only if negative (paused)

                    if (daysLeft <= 0) {
                         // Investment is ended or completed. No action needed for now.
                         actionButton = `<span class="investment-ended">Completed</span>`;
                         invHtml += `
                            <div class="admin-investment-item" style="border-left: 5px solid ${statusColor};">
                                <div class="admin-investment-info">
                                    <p><strong>á‹•á‰…á‹µ:</strong> ${inv.name} | <strong>áˆ˜áŒ áŠ•:</strong> ${inv.amount.toFixed(2)} ETB</p>
                                    <p><strong>á‰°áŒ á‰ƒáˆš:</strong> ${inv.userName} (${inv.userId})</p>
                                    <p><strong>á‰€áˆª á‰€áŠ“á‰µ (Days Left):</strong> <span style="font-weight: bold; color: ${statusColor};">0</span> / ${inv.daysTotal} á‰€áŠ“á‰µ</p>
                                    <p><strong>á‹¨á‰°áŒˆáŠ˜ á‰µáˆ­á (Profit Earned):</strong> ${inv.profitEarned.toFixed(2)} ETB</p>
                                </div>
                                <div class="admin-actions">
                                    ${actionButton}
                                </div>
                            </div>
                         `;
                    } else { 
                        // For active investments, show an end button
                        actionButton = `<button class="end-investment-btn" data-user-id="${inv.userId}" data-inv-id="${inv.id}">ğŸ›‘ End</button>`;
                        invHtml += `
                            <div class="admin-investment-item" style="border-left: 5px solid ${statusColor};">
                                <div class="admin-investment-info">
                                    <p><strong>á‹•á‰…á‹µ:</strong> ${inv.name} | <strong>áˆ˜áŒ áŠ•:</strong> ${inv.amount.toFixed(2)} ETB</p>
                                    <p><strong>á‰°áŒ á‰ƒáˆš:</strong> ${inv.userName} (${inv.userId})</p>
                                    <p><strong>á‰€áˆª á‰€áŠ“á‰µ (Days Left):</strong> <span style="font-weight: bold; color: ${statusColor};">${daysLeft}</span> / ${inv.daysTotal} á‰€áŠ“á‰µ ${daysToResume}</p>
                                    <p><strong>á‹¨á‰°áŒˆáŠ˜ á‰µáˆ­á (Profit Earned):</strong> ${inv.profitEarned.toFixed(2)} ETB</p>
                                </div>
                                <div class="admin-actions">
                                    ${actionButton}
                                </div>
                            </div>
                        `;
                    }
                });

                adminInvestmentList.innerHTML = invHtml;

                // Add event listeners for the new buttons
                document.querySelectorAll('.end-investment-btn, .resume-investment-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const userId = this.getAttribute('data-user-id');
                        const invId = this.getAttribute('data-inv-id');
                        // Determine action based on class
                        const action = this.classList.contains('end-investment-btn') ? 'end' : 'resume';
                        handleAdminInvestmentAction(userId, invId, action);
                    });
                });

            } catch (error) {
                console.error("Error fetching admin investments:", error);
                adminInvestmentList.innerHTML = '<p style="text-align: center; color: #f44336;">áˆ˜áˆ¨áŒƒá‹áŠ• á‰ áˆ›áˆáŒ£á‰µ áˆ‹á‹­ áˆµáˆ…á‰°á‰µ á‰°áˆáŒ¥áˆ¯áˆá¢</p>';
            }
        }

        // Admin function to manage user investments
        async function handleAdminInvestmentAction(userId, invId, action) {
            if (!isAdmin) return;
            const user = await getUserData(userId);
            if (!user) {
                alert("âš ï¸ á‰°áŒ á‰ƒáˆšá‹ áŠ áˆá‰°áŒˆáŠ˜áˆá¢");
                return;
            }

            let investmentsArray = Array.isArray(user.investments) ? user.investments : Object.values(user.investments);
            const invIndex = investmentsArray.findIndex(inv => inv.id === invId);

            if (invIndex === -1) {
                alert("âš ï¸ áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰± áŠ áˆá‰°áŒˆáŠ˜áˆá¢");
                displayUserInvestmentsForAdmin(); 
                return;
            }

            const investment = investmentsArray[invIndex];

            if (action === 'end') {
                const confirmEnd = confirm(`âš ï¸ á‹¨ ${investment.name} áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ áˆˆá‰°áŒ á‰ƒáˆš ${user.name} (${userId}) áˆ›áŒ áŠ“á‰€á‰… á‹­áˆáˆáŒ‹áˆ‰?`);
                if (confirmEnd) {
                    // Set daysLeft to 0 to stop further profit calculation
                    investment.daysLeft = 0; 
                    investmentsArray[invIndex] = investment; // Update the array
                    
                    await updateUserData(userId, { investments: investmentsArray });
                    alert(`âœ… á‹¨ ${investment.name} áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ áŠ á‰¥á‰…á‰·áˆá¢`);
                }
            } 
            
            // Refresh the admin list and user dashboard
            displayUserInvestmentsForAdmin();
            if (activeUser && activeUser.identifier === user.identifier) {
                updateDashboardData();
            }
        }

        // ********** END NEW ADMIN FUNCTIONS **********


        // ********** 6. EVENT HANDLERS - CORE **********

        // ***** 6.1. Login áŠ á‹«á‹«á‹ *****
        loginForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const identifier = document.getElementById('login-identifier').value.trim();
            const password = document.getElementById('login-password').value;
            loginMessage.textContent = '';
            loginMessage.classList.remove('success', 'error');

            if (identifier === adminCredentials.identifier && password === adminCredentials.password) {
                isAdmin = true;
                loginMessage.textContent = 'âœ… á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‹ˆá‹° áŠ á‹µáˆšáŠ• áŒˆá‰¥á‰°á‹‹áˆ!';
                loginMessage.classList.add('success');
                setTimeout(() => {
                    loginRegisterArea.style.display = 'none';
                    dashboardArea.style.display = 'none';
                    adminDashboardArea.style.display = 'block';
                    switchAdminPage('transactions'); // Use the new switch function
                    loginForm.reset();
                }, 500);
                return;
            }

            // User Login
            const userData = await getUserData(identifier);

            if (userData) {
                if (userData.password === password) {
                    activeUser = userData;
                    isAdmin = false;
                    loginMessage.textContent = 'âœ… á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ áŒˆá‰¥á‰°á‹‹áˆ!';
                    loginMessage.classList.add('success');
                    setTimeout(() => {
                        loginRegisterArea.style.display = 'none';
                        dashboardArea.style.display = 'block';
                        adminDashboardArea.style.display = 'none';
                        updateDashboardData(); // á‹³áˆ½á‰¦áˆ­á‹±áŠ• á‰ áˆ˜áˆ¨áŒƒ á‹«á‹˜áˆáŠ“áˆ
                        switchDashboardPage('home'); // á‹ˆá‹° Home áŒˆáŒ½ á‹­á‹ˆáˆµá‹³áˆ
                        loginForm.reset();
                    }, 500);
                } else {
                    loginMessage.textContent = 'âš ï¸ áˆµáˆáŠ­ á‰áŒ¥áˆ­ á‹ˆá‹­áˆ á‹¨á‹­áˆˆá á‰ƒáˆ á‹¨á‰°áˆ³áˆ³á‰° áŠá‹!';
                    loginMessage.classList.add('error');
                }
            } else {
                loginMessage.textContent = 'âš ï¸ áˆµáˆáŠ­ á‰áŒ¥áˆ­ á‹ˆá‹­áˆ á‹¨á‹­áˆˆá á‰ƒáˆ á‹¨á‰°áˆ³áˆ³á‰° áŠá‹!';
                loginMessage.classList.add('error');
            }
        });


        // ***** 6.2. Register áŠ á‹«á‹«á‹ *****
        registerForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            const name = document.getElementById('register-name').value.trim();
            const phone = document.getElementById('register-phone').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            const referralCode = document.getElementById('register-referral').value.trim();

            registerMessage.textContent = '';
            registerMessage.classList.remove('success', 'error');

            if (password !== confirmPassword) {
                registerMessage.textContent = 'âš ï¸ á‹«áˆµáŒˆá‰¡á‰µ á‹¨á‹­áˆˆá á‰ƒáˆ áŠ á‹­áˆ˜áˆ³áˆ°áˆáˆ!';
                registerMessage.classList.add('error');
                return;
            }
            if (password.length < 6) {
                registerMessage.textContent = 'âš ï¸ á‹¨á‹­áˆˆá á‰ƒáˆ á‰¢á‹«áŠ•áˆµ 6 áŠá‹°áˆá‰½ áˆ˜áˆ†áŠ• áŠ áˆˆá‰ á‰µ!';
                registerMessage.classList.add('error');
                return;
            }
            if (!/^\d+$/.test(phone)) {
                 registerMessage.textContent = 'âš ï¸ áˆµáˆáŠ­ á‰áŒ¥áˆ­á‹ á‰µáŠ­áŠ­áˆ áŠ á‹­á‹°áˆˆáˆá¢';
                 registerMessage.classList.add('error');
                 return;
            }

            const existingUser = await getUserData(phone);
            if (existingUser) {
                registerMessage.textContent = 'âš ï¸ á‹­áˆ… áˆµáˆáŠ­ á‰áŒ¥áˆ­ áŠ áˆµá‰€á‹µáˆ á‰°áˆ˜á‹áŒá‰§áˆ!';
                registerMessage.classList.add('error');
                return;
            }

            // Check if referral code exists
            let referrer = null;
            if (referralCode) {
                referrer = await getUserData(referralCode);
                if (!referrer) {
                    // Warning but allow registration
                    alert("âš ï¸ á‹«áˆµáŒˆá‰¡á‰µ Referral Code áŠ áˆá‰°áŒˆáŠ˜áˆ! á‹«áˆˆ Referral Code á‹­á‰€áŒ¥áˆ‹áˆ‰á¢");
                }
            }
            
            try {
                // Create new user object
                const newUser = {
                    name: name,
                    identifier: phone, // Using phone number as the unique identifier
                    password: password, 
                    referralCode: phone, // User's own referral code is their phone number
                    referredBy: referrer ? referrer.identifier : null,
                    balance: 50.00, // Initial sign-up bonus
                    totalInvested: 0.00,
                    transactions: [{ // Initial bonus transaction
                        id: 'tx_bonus_' + Date.now(),
                        type: "Sign-up Bonus",
                        amount: 50.00,
                        date: new Date().toISOString().slice(0, 10),
                        status: "Completed"
                    }],
                    investments: [],
                    lastProfitCalculated: new Date().toISOString(), // Initialize profit calculation date
                    registrationDate: new Date().toISOString()
                };

                // Save new user to Firebase using phone number as the key
                await usersRef.child(phone).set(newUser);
                registerMessage.textContent = 'âœ… á‹¨áˆá‹áŒˆá‰£ áˆ‚á‹°á‰± á‰°áˆ³áŠ­á‰·áˆá¢ áŠ áˆáŠ• Login áˆ›á‹µáˆ¨áŒ á‹­á‰½áˆ‹áˆ‰!';
                registerMessage.classList.add('success');
                registerForm.reset();

                // á‹ˆá‹° Login áŒˆáŒ½ áˆ˜á‰€á‹¨áˆ­
                setTimeout(() => switchAuthTab('login'), 2000);

            } catch (error) {
                console.error("Firebase registration failed:", error);
                registerMessage.textContent = 'âš ï¸ áˆá‹áŒˆá‰£á‹ áŠ áˆá‰°áˆ³áŠ«áˆá¢ áŠ¥á‰£áŠ­á‹ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢';
                registerMessage.classList.add('error');
            }
        });

        // ********** 7. EVENT HANDLERS - DASHBOARD **********

        // ***** 7.1. Deposit áŠ á‹«á‹«á‹ *****
        depositBtn.addEventListener('click', () => {
            mainHomeContentDiv.style.display = 'none';
            depositPageContentDiv.style.display = 'block';
            withdrawPageContentDiv.style.display = 'none';
            depositFormMessage.textContent = '';
            depositForm.reset();
        });

        backToHomeFromDepositBtn.addEventListener('click', () => {
            mainHomeContentDiv.style.display = 'block';
            depositPageContentDiv.style.display = 'none';
            depositFormMessage.textContent = '';
        });

        depositForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (!activeUser) return logout();

            const amount = parseFloat(depositAmountInput.value);
            const txId = transactionIdInput.value.trim();

            depositFormMessage.textContent = '';
            depositFormMessage.classList.remove('success', 'error');

            if (amount < 500) {
                depositFormMessage.textContent = 'âš ï¸ á‹¨áŒˆá‰£á‹ áˆ˜áŒ áŠ• áŠ¨á‹á‰…á‰°áŠ›á‹ á‹¨ 500 ETB áŒˆá‹°á‰¥ á‹«áŠáˆ° áŠá‹á¢';
                depositFormMessage.classList.add('error');
                return;
            }

            // Create new pending deposit transaction
            const newTx = {
                id: txId, // Using the user's provided transaction ID
                type: "Deposit",
                amount: amount,
                date: new Date().toISOString().slice(0, 10),
                status: "Pending",
                user: activeUser.identifier,
                details: `Transaction ID: ${txId}`
            };

            // Add to activeUser's transactions array
            let transactionsArray = Array.isArray(activeUser.transactions) ? activeUser.transactions : (activeUser.transactions ? Object.values(activeUser.transactions) : []);
            transactionsArray.push(newTx);
            activeUser.transactions = transactionsArray;

            // Update Firebase
            await updateUserData(activeUser.identifier, {
                transactions: activeUser.transactions 
            });

            depositFormMessage.textContent = `âœ… á‹¨ ${amount.toFixed(2)} ETB Deposit áŒ¥á‹«á‰„ áŒˆá‰¥á‰·áˆá¢ á‹¨áŠ á‹µáˆšáŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ« á‹­áŒ á‰¥á‰á¢`;
            depositFormMessage.classList.add('success');
            depositForm.reset();
        });

        // ***** 7.2. Withdraw áŠ á‹«á‹«á‹ *****
        withdrawBtn.addEventListener('click', () => {
            mainHomeContentDiv.style.display = 'none';
            depositPageContentDiv.style.display = 'none';
            withdrawPageContentDiv.style.display = 'block';
            withdrawFormMessage.textContent = '';
            withdrawForm.reset();
        });

        backToHomeFromWithdrawBtn.addEventListener('click', () => {
            mainHomeContentDiv.style.display = 'block';
            withdrawPageContentDiv.style.display = 'none';
            withdrawFormMessage.textContent = '';
        });

        withdrawForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (!activeUser) return logout();

            const amount = parseFloat(withdrawAmountInput.value);
            const bankName = withdrawBankNameInput.value;
            const fullName = withdrawFullNameInput.value.trim();
            const accountNumber = withdrawAccountNumberInput.value.trim();

            withdrawFormMessage.textContent = '';
            withdrawFormMessage.classList.remove('success', 'error');

            if (amount < 100) {
                withdrawFormMessage.textContent = 'âš ï¸ á‰¢á‹«áŠ•áˆµ 100 ETB áˆ›á‹áŒ£á‰µ á‹­á‰½áˆ‹áˆ‰á¢';
                withdrawFormMessage.classList.add('error');
                return;
            }

            if (amount > activeUser.balance) {
                withdrawFormMessage.textContent = `âš ï¸ á‰ á‰‚ á‰€áˆª áˆ‚áˆ³á‰¥ á‹¨áˆá‰µáˆ! (${activeUser.balance.toFixed(2)} ETB áŠá‹ á‹«áˆˆá‹)`;
                withdrawFormMessage.classList.add('error');
                return;
            }

            // áŒˆáŠ•á‹˜á‰¡áŠ• áŠ¨áˆ˜áˆˆá‹«á‹ áˆ‹á‹­ áˆ˜á‰€áŠáˆµ
            activeUser.balance -= amount;

            const newTx = {
                id: 'tx_withdraw_' + Date.now(),
                type: "Withdraw",
                amount: amount,
                date: new Date().toISOString().slice(0, 10),
                status: "Pending",
                user: activeUser.identifier,
                bankName: bankName,
                fullName: fullName,
                accountNumber: accountNumber
            };

            // Add to activeUser's transactions array
            let transactionsArray = Array.isArray(activeUser.transactions) ? activeUser.transactions : (activeUser.transactions ? Object.values(activeUser.transactions) : []);
            transactionsArray.push(newTx);
            activeUser.transactions = transactionsArray;

            // Update Firebase
            await updateUserData(activeUser.identifier, {
                balance: activeUser.balance,
                transactions: activeUser.transactions
            });

            // Update the UI
            updateDashboardData();

            withdrawFormMessage.textContent = `âœ… á‹¨ ${amount.toFixed(2)} ETB Withdraw áŒ¥á‹«á‰„ áŒˆá‰¥á‰·áˆá¢ á‹¨áŠ á‹µáˆšáŠ• áˆ›áˆ¨áŒ‹áŒˆáŒ« á‹­áŒ á‰¥á‰á¢`;
            withdrawFormMessage.classList.add('success');
            withdrawForm.reset();
        });

        // ***** 7.3. Investment Plan Selection *****
        planButtons.forEach(button => {
            button.addEventListener('click', function() {
                // Read plan data from data attributes
                selectedPlan = {
                    name: this.getAttribute('data-plan'),
                    min: parseFloat(this.getAttribute('data-min')),
                    max: parseFloat(this.getAttribute('data-max')),
                    rate: parseFloat(this.getAttribute('data-rate')),
                    days: parseInt(this.getAttribute('data-days'))
                };

                // Update purchase form UI
                selectedPlanNameDisplay.textContent = selectedPlan.name;
                currentBalancePurchaseDisplay.textContent = activeUser.balance.toFixed(2);
                planInfoDisplay.innerHTML = `
                    áˆ˜áŒ áŠ•: <strong>ETB ${selectedPlan.min} - ${selectedPlan.max.toLocaleString()}</strong> |
                    á‹•áˆˆá‰³á‹Š á‰µáˆ­á: <strong>${selectedPlan.rate}%</strong> |
                    áŒŠá‹œ: <strong>${selectedPlan.days} á‰€áŠ“á‰µ</strong>
                `;
                
                // Set input constraints
                purchaseAmountInput.min = selectedPlan.min;
                purchaseAmountInput.max = selectedPlan.max;
                purchaseAmountInput.value = selectedPlan.min; // Default to min amount

                // Hide plans, show form
                document.querySelector('.investment-plans h3').style.display = 'none';
                document.querySelector('.plan-grid').style.display = 'none';
                purchaseFormBox.style.display = 'block';
                purchaseFormMessage.textContent = '';
            });
        });

        backToPlansBtn.addEventListener('click', () => {
            document.querySelector('.investment-plans h3').style.display = 'block';
            document.querySelector('.plan-grid').style.display = 'flex';
            purchaseFormBox.style.display = 'none';
        });

        // ***** 7.4. Investment Purchase *****
        purchaseForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (!activeUser || !selectedPlan) return logout();

            const amount = parseFloat(purchaseAmountInput.value);
            purchaseFormMessage.textContent = '';
            purchaseFormMessage.classList.remove('success', 'error');

            if (amount < selectedPlan.min || amount > selectedPlan.max || amount > activeUser.balance) {
                purchaseFormMessage.textContent = `âš ï¸ á‹«áˆµáŒˆá‰¡á‰µ áˆ˜áŒ áŠ• áŠ¨á‹•á‰…á‹± áŒˆá‹°á‰¥ á‹áŒª á‹ˆá‹­áˆ áŠ¨á‰€áˆª áˆ‚áˆ³á‰¥á‹ á‰ áˆ‹á‹­ áŠá‹á¢ (Min: ${selectedPlan.min}, Max: ${selectedPlan.max}, Balance: ${activeUser.balance.toFixed(2)})`;
                purchaseFormMessage.classList.add('error');
                return;
            }

            // 1. áŒˆáŠ•á‹˜á‰¡áŠ• áŠ¨áˆ˜áˆˆá‹«á‹ áˆ‹á‹­ áˆ˜á‰€áŠáˆµ
            activeUser.balance -= amount;

            // 2. áŒ á‰…áˆ‹áˆ‹ áŠ¢áŠ•á‰¨áˆµá‰µáˆ˜áŠ•á‰µ áˆ˜áŒ¨áˆ˜áˆ­
            activeUser.totalInvested = (activeUser.totalInvested || 0) + amount;

            // 3. Transaction áˆ˜ááŒ áˆ­
            const purchaseTx = {
                id: 'tx_purchase_' + Date.now(),
                type: "Investment Purchase",
                amount: -amount,
                date: new Date().toISOString().slice(0, 10),
                status: "Completed",
                details: `Purchased ${selectedPlan.name} Plan`
            };

            let transactionsArray = Array.isArray(activeUser.transactions) ? activeUser.transactions : (activeUser.transactions ? Object.values(activeUser.transactions) : []);
            transactionsArray.push(purchaseTx);
            activeUser.transactions = transactionsArray;

            // 4. áŠ á‹²áˆµ Investment áˆ˜ááŒ áˆ­
            const newInvestment = {
                id: 'inv_' + Date.now(),
                name: selectedPlan.name,
                amount: amount,
                rate: selectedPlan.rate,
                daysTotal: selectedPlan.days,
                daysLeft: selectedPlan.days,
                profitEarned: 0.0,
                startDate: new Date().toISOString().slice(0, 10)
            };

            let investmentsArray = Array.isArray(activeUser.investments) ? activeUser.investments : (activeUser.investments ? Object.values(activeUser.investments) : []);
            investmentsArray.push(newInvestment);
            activeUser.investments = investmentsArray;
            
            // 5. Referral Bonus (80 ETB) Check - only for the first investment
            if (activeUser.referredBy) {
                // Simplified check: check if the new investments array size is 1 (excluding the 50 ETB bonus)
                if (investmentsArray.length === 1) { 
                    const referrerIdentifier = activeUser.referredBy;
                    const referrer = await getUserData(referrerIdentifier);

                    if (referrer) {
                        const bonusAmount = 80.00;
                        referrer.balance = (referrer.balance || 0) + bonusAmount;
                        
                        const bonusTx = {
                            id: 'tx_referral_bonus_' + Date.now(),
                            type: "Referral Bonus",
                            amount: bonusAmount,
                            date: new Date().toISOString().slice(0, 10),
                            status: "Completed",
                            details: `Bonus from ${activeUser.name} (${activeUser.identifier}) first investment`
                        };

                        let referrerTxs = Array.isArray(referrer.transactions) ? referrer.transactions : (referrer.transactions ? Object.values(referrer.transactions) : []);
                        referrerTxs.push(bonusTx);
                        referrer.transactions = referrerTxs;
                        
                        // Update referrer data in Firebase
                        await updateUserData(referrerIdentifier, {
                            balance: referrer.balance,
                            transactions: referrer.transactions
                        });
                        
                        // Alert for referrer bonus
                        alert(`ğŸ áˆˆ Referrerá‹ (${referrer.name}) 80 ETB Bonus áŒˆá‰¥á‰·áˆ!`);
                    }
                }
            }


            // 6. Update Firebase for the current user
            await updateUserData(activeUser.identifier, {
                balance: activeUser.balance,
                totalInvested: activeUser.totalInvested,
                transactions: activeUser.transactions,
                investments: activeUser.investments
            });

            // 7. UI Update
            updateDashboardData(); 

            purchaseFormMessage.textContent = `âœ… á‹¨ ${selectedPlan.name} á‹•á‰…á‹µ áŒá‹¢ á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°áŒ áŠ“á‰‹áˆ!`;
            purchaseFormMessage.classList.add('success');

            // Hide form and show plans again after 2 seconds
            setTimeout(() => {
                document.querySelector('.investment-plans h3').style.display = 'block';
                document.querySelector('.plan-grid').style.display = 'flex';
                purchaseFormBox.style.display = 'none';
            }, 2000);
        });
        
        // ***** 7.5. Referral Link Copying (NEW) *****
        copyReferralLinkBtn.addEventListener('click', async () => {
            if (referralLinkDisplay) {
                // Select the text field
                referralLinkDisplay.select();
                referralLinkDisplay.setSelectionRange(0, 99999); // For mobile devices

                try {
                    await navigator.clipboard.writeText(referralLinkDisplay.value);
                    alert("âœ… Referral Link á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ áŠ®á’ á‰°á‹°áˆ­áŒ“áˆ!");
                } catch (err) {
                    // Fallback for older browsers
                    console.error('Failed to copy text: ', err);
                    try {
                        document.execCommand('copy');
                        alert("âœ… Referral Link áŠ®á’ á‰°á‹°áˆ­áŒ“áˆá¢");
                    } catch (err2) {
                        alert("âš ï¸ áŠ®á’ áˆ›á‹µáˆ¨áŒ áŠ áˆá‰°á‰»áˆˆáˆá¢ áŠ¥á‰£áŠ­á‹ áˆŠáŠ•áŠ©áŠ• áŠ¥áˆ«áˆµá‹ á‹­á‰…á‹±á¢");
                    }
                }
            }
        });

        // ********** 8. EVENT HANDLERS - NAVIGATION **********

        // Utility to switch between dashboard pages
        function switchDashboardPage(pageId) {
            allContentSections.forEach(section => section.classList.remove('active'));
            allNavButtons.forEach(button => button.classList.remove('nav-active'));

            if (pageId === 'home') {
                homeContent.classList.add('active');
                navHome.classList.add('nav-active');
                // Ensure main home content is visible when switching back
                mainHomeContentDiv.style.display = 'block'; 
                depositPageContentDiv.style.display = 'none';
                withdrawPageContentDiv.style.display = 'none';
            } else if (pageId === 'investment') {
                investmentContent.classList.add('active');
                navInvestment.classList.add('nav-active');
                // Reset to plans view
                document.querySelector('.investment-plans h3').style.display = 'block';
                document.querySelector('.plan-grid').style.display = 'flex';
                purchaseFormBox.style.display = 'none';
            } else if (pageId === 'customer-service') {
                customerServiceContent.classList.add('active');
                navCustomerService.classList.add('nav-active');
            } else if (pageId === 'account') {
                accountContent.classList.add('active');
                navAccount.classList.add('nav-active');
                // Ensure sub-pages are hidden when returning to main account
                historyContent.style.display = 'none';
                changePasswordContent.style.display = 'none';
            } else if (pageId === 'team') {
                teamContent.classList.add('active');
                navTeam.classList.add('nav-active');
            }
        }

        // Login/Register Tab Clicks
        loginTab.addEventListener('click', () => switchAuthTab('login'));
        registerTab.addEventListener('click', () => switchAuthTab('register'));
        goToRegisterLink.addEventListener('click', (e) => { e.preventDefault(); switchAuthTab('register'); });
        goToLoginLink.addEventListener('click', (e) => { e.preventDefault(); switchAuthTab('login'); });

        // Dashboard Navigation Handlers
        navHome.addEventListener('click', () => switchDashboardPage('home'));
        navInvestment.addEventListener('click', () => switchDashboardPage('investment'));
        navCustomerService.addEventListener('click', () => switchDashboardPage('customer-service'));
        navAccount.addEventListener('click', () => switchDashboardPage('account'));
        navTeam.addEventListener('click', () => switchDashboardPage('team'));
        
        // Account Page Button Handlers
        transactionHistoryBtn.addEventListener('click', () => {
            accountContent.classList.remove('active');
            historyContent.classList.add('active');
            historyContent.style.display = 'block';
            displayTransactionHistory();
        });
        backToAccountFromHistoryBtn.addEventListener('click', () => {
            historyContent.classList.remove('active');
            historyContent.style.display = 'none';
            accountContent.classList.add('active');
        });
        
        changePasswordBtn.addEventListener('click', () => {
            accountContent.classList.remove('active');
            changePasswordContent.classList.add('active');
            changePasswordContent.style.display = 'block';
            changePasswordMessage.textContent = '';
            changePasswordForm.reset();
        });
        backToAccountFromPasswordBtn.addEventListener('click', () => {
            changePasswordContent.classList.remove('active');
            changePasswordContent.style.display = 'none';
            accountContent.classList.add('active');
        });

        logoutBtnAccount.addEventListener('click', logout);

        // Change Password Form Handler
        changePasswordForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            if (!activeUser) return logout();

            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmNewPassword = document.getElementById('confirm-new-password').value;

            changePasswordMessage.textContent = '';
            changePasswordMessage.classList.remove('success', 'error');

            if (currentPassword !== activeUser.password) {
                changePasswordMessage.textContent = 'âš ï¸ áŠ áˆáŠ• á‹«áˆµáŒˆá‰¡á‰µ á‹¨á‹­áˆˆá á‰ƒáˆ á‹¨á‰°áˆ³áˆ³á‰° áŠá‹!';
                changePasswordMessage.classList.add('error');
                return;
            }
            if (newPassword !== confirmNewPassword) {
                changePasswordMessage.textContent = 'âš ï¸ áŠ á‹²áˆ¶á‰¹ á‹¨á‹­áˆˆá á‰ƒáˆá‰½ áŠ á‹­áˆ˜áˆ³áˆ°áˆ‰áˆ!';
                changePasswordMessage.classList.add('error');
                return;
            }
            if (newPassword.length < 6) {
                changePasswordMessage.textContent = 'âš ï¸ áŠ á‹²áˆµ á‹¨á‹­áˆˆá á‰ƒáˆ á‰¢á‹«áŠ•áˆµ 6 áŠá‹°áˆá‰½ áˆ˜áˆ†áŠ• áŠ áˆˆá‰ á‰µ!';
                changePasswordMessage.classList.add('error');
                return;
            }

            // Update password in global user object and Firebase
            activeUser.password = newPassword;
            const success = await updateUserData(activeUser.identifier, { password: newPassword });

            if (success) {
                changePasswordMessage.textContent = 'âœ… á‹¨á‹­áˆˆá á‰ƒáˆá‹ á‰ á‰°áˆ³áŠ« áˆáŠ”á‰³ á‰°á‰€á‹­áˆ¯áˆ!';
                changePasswordMessage.classList.add('success');
                changePasswordForm.reset();
                setTimeout(() => {
                     // Go back to account page
                    changePasswordContent.classList.remove('active');
                    changePasswordContent.style.display = 'none';
                    accountContent.classList.add('active');
                }, 2000);
            } else {
                changePasswordMessage.textContent = 'âš ï¸ á‹¨á‹­áˆˆá á‰ƒáˆ áˆ˜á‰€á‹¨áˆ­ áŠ áˆá‰°áˆ³áŠ«áˆá¢ áŠ¥á‰£áŠ­á‹ áŠ¥áŠ•á‹°áŒˆáŠ“ á‹­áˆáŠ­áˆ©á¢';
                changePasswordMessage.classList.add('error');
            }
        });

        // Admin Navigation Handlers
        adminNavTransactions.addEventListener('click', () => switchAdminPage('transactions'));
        adminNavInvestments.addEventListener('click', () => switchAdminPage('investments'));

        // Admin Logout
        adminLogoutBtn.addEventListener('click', logout);


        // ********** 9. Initialization (áŒˆáŒ¹ áˆ²áŠ¨áˆá‰µ) **********
        // á‰ áŒˆáŒ½ áˆá‹µ áŒŠá‹œ áˆ˜áŒ€áˆ˜áˆªá‹« Login/Register áŒˆáŒ½áŠ• áˆ›áˆ³á‹¨á‰µ
        loginRegisterArea.style.display = 'flex';
        dashboardArea.style.display = 'none';
        adminDashboardArea.style.display = 'none';
        
        // Check for referral parameter in URL
        const urlParams = new URLSearchParams(window.location.search);
        const referralCodeFromURL = urlParams.get('ref');
        
        if (referralCodeFromURL) {
            // Switch to Register tab and pre-fill
            switchAuthTab('register'); 
            const registerReferralInput = document.getElementById('register-referral');
            if (registerReferralInput) {
                registerReferralInput.value = referralCodeFromURL;
                // á‹­áˆ… áŠ®á‹µ referral code áˆ˜áŒˆáŠ˜á‰±áŠ• áŠ¥áŠ“ áˆ˜áˆáˆ‹á‰±áŠ• á‹«áˆ³á‹«áˆá¢
                console.log(`Referral Code Found: ${referralCodeFromURL}. Switching to Register tab.`); 
            }
        } else {
            // Default to Login tab
            switchAuthTab('login');
        }
        
    </script>
</body>
</html>